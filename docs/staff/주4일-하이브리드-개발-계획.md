# 주4일 근무제 시스템 고도화 - 하이브리드 개발 계획

**작성일**: 2025-01-XX  
**버전**: 2.0 (하이브리드 접근 방식)

---

## 📋 개발 접근 방식: 하이브리드

**순서**: 프론트엔드 UI 설계 → API 스펙 설계 → 비즈니스 로직 구현 → 통합

**이유**: 기획력 보완을 위해 UI부터 설계하고, 사용자 피드백을 빠르게 반영

---

## 📁 기존 파일 활용 계획

### ✅ 기존 파일 (수정/업데이트)

#### 백엔드 (`routes/staff/`)
1. **`work-schedules.js`** ⭐ **대폭 수정**
   - 기존: 5개월 주기 정방향 순환
   - 신규: 4주 주기 반대 방향 순환
   - 순환 계산 함수 교체
   - 일시적 변경 API 추가
   - 반차 검증 로직 수정

2. **`employees.js`** - **일부 수정**
   - 수습 기간 체크 로직 추가 (선택)

3. **`departments.js`** - **변경 없음**

#### 프론트엔드 (`public/pages/staff/`)
1. **`employee-schedule.html`** ⭐ **대폭 수정**
   - 순환 설명 텍스트 변경
   - 일시적 변경 UI 추가
   - 수습 기간 안내 추가

#### 프론트엔드 (`public/js/staff/`)
1. **`employee-schedule.js`** ⭐ **대폭 수정**
   - 순환 계산 로직 수정
   - 일시적 변경 기능 추가
   - 반차 검증 로직 수정

2. **`work-schedule-manager.js`** - **수정**
   - 일시적 변경 관리 기능 추가

3. **`employee-list.js`** - **변경 없음**
4. **`employee-modal.js`** - **변경 없음**
5. **`department-manager.js`** - **변경 없음**
6. **`vacations.js`** - **일부 수정** (반차 검증 로직)

---

## 📝 새로 만들 파일 목록

### 백엔드 (`routes/staff/`)

#### 1. **`work-schedule-helpers.js`** ⭐ **신규 생성**
**목적**: 순환 계산 및 공휴일 처리 헬퍼 함수 모음

**포함 함수**:
- `calculateOffDayByWeekCycle()` - 4주 주기 반대 방향 순환 계산
- `getWeekStartDate()` - 주 시작일(월요일) 계산
- `hasHolidayInWeek()` - 공휴일 포함 주 감지
- `isProbationPeriod()` - 수습 기간 체크
- `validateHalfDayInSameWeek()` - 같은 주 반차 검증

**예상 라인 수**: ~200-300줄

---

#### 2. **`schedule-changes.js`** ⭐ **신규 생성**
**목적**: 일시적 휴무일 변경 이력 관리 API

**포함 엔드포인트**:
- `GET /api/staff/schedule-changes/pending` - 승인 대기 목록
- `GET /api/staff/schedule-changes/my-requests` - 내 요청 목록
- `GET /api/staff/schedule-changes/:id` - 변경 상세 조회

**예상 라인 수**: ~150-200줄

---

### 프론트엔드 (`public/js/staff/`)

#### 3. **`temporary-change-manager.js`** ⭐ **신규 생성**
**목적**: 일시적 휴무일 변경 요청 및 관리

**주요 기능**:
- 변경 요청 모달 관리
- 승인 대기 목록 표시 (팀장용)
- 변경 이력 조회

**예상 라인 수**: ~300-400줄

---

#### 4. **`schedule-utils.js`** ⭐ **신규 생성**
**목적**: 스케줄 관련 유틸리티 함수

**포함 함수**:
- 날짜 포맷팅
- 요일 계산
- 주 단위 검증
- 공휴일 체크 (프론트엔드)

**예상 라인 수**: ~100-150줄

---

### 프론트엔드 (`public/pages/staff/`)

#### 5. **`schedule-change-approval.html`** ⭐ **신규 생성** (선택)
**목적**: 팀장용 승인 대기 목록 페이지

**기능**:
- 승인 대기 목록 표시
- 승인/거부 처리
- 변경 이력 조회

**예상 라인 수**: ~200-300줄

---

### 유틸리티 (`utils/` 또는 `routes/staff/`)

#### 6. **`holiday-service.js`** - **신규 생성** (선택)
**목적**: 공휴일 조회 서비스

**기능**:
- 공휴일 목록 조회
- 특정 주 공휴일 확인

**예상 라인 수**: ~50-100줄

---

## 📊 파일 생성 요약

| 구분 | 파일명 | 타입 | 우선순위 | 예상 라인 |
|------|--------|------|----------|-----------|
| 백엔드 | `work-schedule-helpers.js` | 신규 | ⭐⭐⭐ 필수 | ~250줄 |
| 백엔드 | `schedule-changes.js` | 신규 | ⭐⭐ 중요 | ~175줄 |
| 프론트엔드 | `temporary-change-manager.js` | 신규 | ⭐⭐ 중요 | ~350줄 |
| 프론트엔드 | `schedule-utils.js` | 신규 | ⭐⭐ 중요 | ~125줄 |
| 프론트엔드 | `schedule-change-approval.html` | 신규 | ⭐ 선택 | ~250줄 |
| 백엔드 | `holiday-service.js` | 신규 | ⭐ 선택 | ~75줄 |

**총 신규 파일**: 6개 (필수 4개 + 선택 2개)

---

## 🔄 하이브리드 개발 단계

### Phase 1: 프론트엔드 UI 설계 및 프로토타입 (1주)

**목표**: UI/UX 설계 및 모킹 데이터로 프로토타입 개발

**작업 내용**:
1. ✅ 기존 `employee-schedule.html` 분석
2. ⏳ UI 변경 사항 설계
   - 순환 설명 텍스트 변경
   - 일시적 변경 버튼 추가
   - 수습 기간 안내 추가
3. ⏳ 모킹 데이터로 UI 개발
4. ⏳ 사용자 피드백 수집

**산출물**:
- UI 프로토타입
- 모킹 데이터 구조
- 사용자 피드백

---

### Phase 2: API 스펙 설계 (0.5주)

**목표**: 프론트엔드 요구사항 기반 API 스펙 정의

**작업 내용**:
1. ⏳ API 엔드포인트 목록 작성
2. ⏳ 요청/응답 스펙 정의
3. ⏳ 에러 코드 정의
4. ⏳ 모킹 API 서버 구축 (선택)

**산출물**:
- API 스펙 문서
- 모킹 API 서버 (선택)

---

### Phase 3: 핵심 비즈니스 로직 구현 (1.5주)

**목표**: 4주 주기 반대 방향 순환 시스템 구현

**작업 내용**:
1. ⏳ **`work-schedule-helpers.js`** 생성
   - 순환 계산 함수 구현
   - 공휴일 처리 로직
   - 수습 기간 체크 로직
2. ⏳ **`work-schedules.js`** 수정
   - 기존 순환 로직 교체
   - 새로운 헬퍼 함수 사용
   - 반차 검증 로직 수정
3. ⏳ **`schedule-changes.js`** 생성
   - 일시적 변경 API 구현

**산출물**:
- `work-schedule-helpers.js` (신규)
- `schedule-changes.js` (신규)
- `work-schedules.js` (수정)

---

### Phase 4: API 구현 및 통합 (1주)

**목표**: 실제 API 구현 및 프론트엔드 연동

**작업 내용**:
1. ⏳ 스케줄 조회 API 업데이트
2. ⏳ 일시적 변경 API 구현
3. ⏳ 반차 신청 API 업데이트
4. ⏳ 프론트엔드와 실제 연동

**산출물**:
- 완성된 API 엔드포인트
- 프론트엔드-백엔드 통합

---

### Phase 5: 프론트엔드 구현 (1.5주)

**목표**: 실제 API와 연동한 프론트엔드 완성

**작업 내용**:
1. ⏳ **`temporary-change-manager.js`** 생성
2. ⏳ **`schedule-utils.js`** 생성
3. ⏳ **`employee-schedule.js`** 수정
4. ⏳ **`employee-schedule.html`** 수정
5. ⏳ **`work-schedule-manager.js`** 수정

**산출물**:
- 완성된 프론트엔드 페이지
- 모든 JavaScript 모듈

---

### Phase 6: 테스트 및 안정화 (1주)

**목표**: 전체 시스템 검증 및 버그 수정

**작업 내용**:
1. ⏳ 단위 테스트
2. ⏳ 통합 테스트
3. ⏳ 사용자 시나리오 테스트
4. ⏳ 버그 수정

**산출물**:
- 테스트 리포트
- 버그 수정 내역

---

### Phase 7: 문서화 및 배포 (0.5주)

**목표**: 최종 문서화 및 프로덕션 배포

**작업 내용**:
1. ⏳ 사용자 가이드 작성
2. ⏳ 기술 문서 업데이트
3. ⏳ 프로덕션 배포

**산출물**:
- 사용자 가이드
- 배포 가이드

---

## 📋 파일별 작업 내용 상세

### 1. `work-schedule-helpers.js` (신규)

```javascript
/**
 * 주4일 근무제 헬퍼 함수 모음
 * 
 * 주요 함수:
 * - calculateOffDayByWeekCycle() - 4주 주기 반대 방향 순환 계산
 * - getWeekStartDate() - 주 시작일(월요일) 계산
 * - hasHolidayInWeek() - 공휴일 포함 주 감지
 * - isProbationPeriod() - 수습 기간 체크
 * - validateHalfDayInSameWeek() - 같은 주 반차 검증
 */
```

**필요한 함수**:
- `calculateOffDayByWeekCycle(cycleStartDate, targetDate, initialOffDay)`
- `getWeekStartDate(date)`
- `hasHolidayInWeek(weekStartDate, pool)`
- `isProbationPeriod(hireDate, targetDate)`
- `validateHalfDayInSameWeek(halfDayDate, offDayDate)`

---

### 2. `schedule-changes.js` (신규)

```javascript
/**
 * 일시적 휴무일 변경 이력 관리 API
 * 
 * 엔드포인트:
 * - GET /api/staff/schedule-changes/pending - 승인 대기 목록
 * - GET /api/staff/schedule-changes/my-requests - 내 요청 목록
 * - GET /api/staff/schedule-changes/:id - 변경 상세 조회
 */
```

**필요한 엔드포인트**:
- `GET /api/staff/schedule-changes/pending` (팀장용)
- `GET /api/staff/schedule-changes/my-requests` (직원용)
- `GET /api/staff/schedule-changes/:id` (상세 조회)

---

### 3. `temporary-change-manager.js` (신규)

```javascript
/**
 * 일시적 휴무일 변경 요청 및 관리
 * 
 * 주요 기능:
 * - 변경 요청 모달 관리
 * - 승인 대기 목록 표시 (팀장용)
 * - 변경 이력 조회
 */
```

**주요 클래스/함수**:
- `TemporaryChangeManager` 클래스
- `showChangeRequestModal()`
- `loadPendingChanges()`
- `submitChangeRequest()`

---

### 4. `schedule-utils.js` (신규)

```javascript
/**
 * 스케줄 관련 유틸리티 함수
 * 
 * 주요 함수:
 * - formatDate() - 날짜 포맷팅
 * - getDayOfWeek() - 요일 계산
 * - isSameWeek() - 같은 주인지 확인
 * - checkHoliday() - 공휴일 체크
 */
```

---

## 🎯 우선순위별 작업 순서

### 1단계: 필수 작업 (Phase 1-3)
1. ✅ UI 설계 및 프로토타입
2. ✅ API 스펙 설계
3. ✅ `work-schedule-helpers.js` 생성
4. ✅ `work-schedules.js` 수정
5. ✅ `employee-schedule.js` 수정

### 2단계: 중요 작업 (Phase 4-5)
1. ⏳ `schedule-changes.js` 생성
2. ⏳ `temporary-change-manager.js` 생성
3. ⏳ `schedule-utils.js` 생성
4. ⏳ `employee-schedule.html` 수정

### 3단계: 선택 작업 (Phase 6)
1. ⏳ `schedule-change-approval.html` 생성 (선택)
2. ⏳ `holiday-service.js` 생성 (선택)

---

## 📊 예상 일정 (하이브리드 방식)

| Phase | 작업 내용 | 예상 기간 | 시작일 | 완료일 |
|-------|----------|----------|--------|--------|
| Phase 1 | 프론트엔드 UI 설계 | 1주 | - | - |
| Phase 2 | API 스펙 설계 | 0.5주 | - | - |
| Phase 3 | 핵심 로직 구현 | 1.5주 | - | - |
| Phase 4 | API 구현 및 통합 | 1주 | - | - |
| Phase 5 | 프론트엔드 구현 | 1.5주 | - | - |
| Phase 6 | 테스트 및 안정화 | 1주 | - | - |
| Phase 7 | 문서화 및 배포 | 0.5주 | - | - |
| **총계** | | **7주** | - | - |

---

## ✅ 다음 단계

### 즉시 시작 가능한 작업

1. **UI 프로토타입 설계** (Phase 1)
   - `employee-schedule.html` 변경 사항 정리
   - 모킹 데이터 구조 정의
   - 일시적 변경 UI 설계

2. **API 스펙 문서 작성** (Phase 2)
   - 각 API 엔드포인트 스펙 정의
   - 요청/응답 예시 작성

3. **헬퍼 함수 구현** (Phase 3)
   - `work-schedule-helpers.js` 생성
   - 순환 계산 함수 구현

---

**문서 버전**: 2.0 (하이브리드 접근 방식)  
**최종 업데이트**: 2025-01-XX

