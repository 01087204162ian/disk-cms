# 주 4일 근무제 공휴일 관리 가이드

**작성일**: 2025-12-28  
**목적**: 공휴일 데이터 누락으로 인한 오류 방지

---

## 1. 문제 상황

### 1.1 발생 가능한 문제
- **12월 조회 시 1월 공휴일 미조회**: 12월 29일 주에 1월 1일 공휴일이 포함되지만, 2026년 공휴일이 없어서 인식하지 못함
- **연도 경계 공휴일 누락**: 월별 조회 시 다음 해 공휴일이 포함되지 않음
- **공휴일 포함 주 오판**: 공휴일이 없어서 주 4일 근무가 잘못 적용됨

---

## 2. 구조적 개선 방안

### 2.1 API 개선 (이미 적용)

#### 공휴일 조회 범위 확장
```javascript
// 기존: 해당 월의 주 범위만 조회
WHERE holiday_date >= firstDayWeekStart AND holiday_date <= queryEndDate

// 개선: ±1년 범위로 확장
const queryStartDate = new Date(firstDayWeekStart);
queryStartDate.setFullYear(queryStartDate.getFullYear() - 1); // 1년 전까지
const queryEndDateExtended = new Date(queryEndDate);
queryEndDateExtended.setFullYear(queryEndDateExtended.getFullYear() + 1); // 1년 후까지
```

#### 경고 로그 추가
```javascript
// 공휴일이 없거나 부족한 경우 경고 로그
if (holidayRows.length === 0) {
    console.warn(`[공휴일 경고] ${year}년 ${month}월 조회 시 공휴일 데이터가 없습니다.`);
} else {
    const missingYears = requiredYears.filter(y => !holidayYears.includes(y));
    if (missingYears.length > 0) {
        console.warn(`[공휴일 경고] ${missingYears.join(', ')}년 공휴일 데이터가 없습니다.`);
    }
}
```

---

### 2.2 공휴일 자동 생성 스크립트

#### 고정 공휴일 자동 생성
- **파일**: `database/auto-generate-holidays.sql`
- **실행 시점**: 매년 말 (12월)
- **생성 대상**: 다음 해 고정 공휴일
  - 신정 (1월 1일)
  - 삼일절 (3월 1일)
  - 어린이날 (5월 5일)
  - 현충일 (6월 6일)
  - 광복절 (8월 15일)
  - 개천절 (10월 3일)
  - 한글날 (10월 9일)
  - 성탄절 (12월 25일)

#### 수동 추가 필요 공휴일
- **설날**: 음력 기준 (매년 다름)
- **추석**: 음력 기준 (매년 다름)
- **부처님오신날**: 음력 기준 (매년 다름)

---

### 2.3 모니터링 및 알림

#### 공휴일 데이터 검증
```sql
-- 다음 해 공휴일이 있는지 확인
SELECT 
    YEAR(CURDATE()) + 1) as next_year,
    COUNT(*) as holiday_count
FROM holidays 
WHERE year = YEAR(CURDATE()) + 1;
```

#### 경고 알림
- API 로그에서 공휴일 경고 확인
- 다음 해 공휴일이 없으면 관리자에게 알림

---

## 3. 운영 가이드

### 3.1 매년 말 작업 (12월)

#### 1단계: 다음 해 공휴일 확인
```sql
SELECT * FROM holidays 
WHERE year = YEAR(CURDATE()) + 1 
ORDER BY holiday_date;
```

#### 2단계: 고정 공휴일 자동 생성
```sql
-- database/auto-generate-holidays.sql 실행
```

#### 3단계: 음력 공휴일 수동 추가
- 설날: 음력 1월 1일
- 추석: 음력 8월 15일
- 부처님오신날: 음력 4월 8일

#### 4단계: 확인
```sql
SELECT 
    holiday_date, 
    name, 
    year 
FROM holidays 
WHERE year = YEAR(CURDATE()) + 1 
ORDER BY holiday_date;
```

---

### 3.2 월별 점검

#### 매월 초 공휴일 확인
```sql
-- 현재 월과 다음 월의 공휴일 확인
SELECT 
    holiday_date, 
    name, 
    year 
FROM holidays 
WHERE holiday_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')
AND holiday_date < DATE_FORMAT(DATE_ADD(CURDATE(), INTERVAL 2 MONTH), '%Y-%m-01')
AND is_active = 1
ORDER BY holiday_date;
```

---

### 3.3 에러 발생 시 대응

#### 문제: 공휴일 포함 주가 인식되지 않음

**원인 확인**:
```sql
-- 해당 주의 공휴일 확인
SELECT * FROM holidays 
WHERE holiday_date BETWEEN '2025-12-29' AND '2026-01-04'
AND is_active = 1;
```

**해결 방법**:
1. 누락된 공휴일 추가
2. `update-2026-holidays.sql` 실행
3. API 재호출하여 확인

---

## 4. 자동화 방안

### 4.1 Cron Job 설정 (Linux/Mac)

```bash
# 매년 12월 1일 자동 실행
0 0 1 12 * mysql -u [user] -p[password] [database] < /path/to/auto-generate-holidays.sql
```

### 4.2 Windows 작업 스케줄러

- 작업 스케줄러에서 매년 12월 1일 실행
- `auto-generate-holidays.sql` 실행

### 4.3 Node.js 스케줄러 (권장)

```javascript
// scripts/schedule-holiday-generation.js
const cron = require('node-cron');
const { exec } = require('child_process');

// 매년 12월 1일 자동 실행
cron.schedule('0 0 1 12 *', () => {
    console.log('다음 해 공휴일 자동 생성 시작...');
    exec('mysql -u user -ppassword database < database/auto-generate-holidays.sql', (error, stdout, stderr) => {
        if (error) {
            console.error('공휴일 생성 오류:', error);
        } else {
            console.log('공휴일 생성 완료');
        }
    });
});
```

---

## 5. 체크리스트

### 연간 작업
- [ ] 12월 1일: 다음 해 공휴일 확인
- [ ] 12월 1일: 고정 공휴일 자동 생성 스크립트 실행
- [ ] 12월 중: 음력 공휴일 수동 추가 (설날, 추석, 부처님오신날)
- [ ] 12월 말: 다음 해 공휴일 전체 확인

### 월별 점검
- [ ] 매월 초: 현재 월과 다음 월 공휴일 확인
- [ ] API 로그에서 공휴일 경고 확인

### 에러 대응
- [ ] 공휴일 포함 주가 인식되지 않을 때: 공휴일 데이터 확인
- [ ] 누락된 공휴일 즉시 추가

---

## 6. 참고 자료

- **고정 공휴일 목록**: `database/update-2026-holidays.sql`
- **자동 생성 스크립트**: `database/auto-generate-holidays.sql`
- **API 개선 코드**: `routes/staff/work-schedules.js` (라인 339-362)

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-12-28

