# 주 4일 근무제 시스템 다음 개발 계획

**작성일**: 2025-12-28  
**현재 버전**: 2.0  
**다음 버전**: 3.0

---

## 📋 현재 완료된 기능

### ✅ 완료된 기능 목록

1. **기본 휴무일 계산 시스템**
   - 사이클 번호 계산 (공휴일 주 제외)
   - 휴무일 시프트 로직 (금→목→수→화→월 순환)
   - 공휴일 주 처리 (주 4일 근무 해제)

2. **공휴일 관리 시스템**
   - 공휴일 CRUD (조회, 추가, 수정, 삭제)
   - 대체 공휴일 자동 생성
   - 데이터 검증 기능
   - 3년간 일괄 조회 (2025, 2026, 2027)

3. **개인 스케줄 조회**
   - 월별 스케줄 조회 API
   - 사이클 정보 표시
   - 공휴일 포함 여부 표시

4. **헬퍼 함수**
   - `getCycleNumber`: 사이클 번호 계산
   - `getCycleWeek`: 사이클 내 주차 계산
   - `calculateOffDayByWeekCycle`: 휴무일 계산
   - `hasHolidayInWeek`: 공휴일 주 판단
   - `calculateCycleInfo`: 사이클 정보 계산

---

## 🚀 다음 개발 우선순위

### Phase 1: 반차 신청/승인 시스템 (우선순위: 높음)

#### 1.1 반차 신청 기능
- **목적**: 직원이 휴무일을 반으로 나누어 사용
- **기능**:
  - 반차 신청 폼 (오전 반차 / 오후 반차 선택)
  - 신청 날짜 선택 (휴무일이 아닌 날짜)
  - 신청 사유 입력
  - 신청 상태 관리 (대기, 승인, 거부)

#### 1.2 반차 승인 기능
- **목적**: 관리자가 반차 신청을 승인/거부
- **기능**:
  - 반차 신청 목록 조회
  - 승인/거부 처리
  - 승인 시 자동으로 스케줄 업데이트
  - 알림 기능

#### 1.3 반차 검증 로직
- **목적**: 반차 사용 규칙 준수 확인
- **검증 항목**:
  - 공휴일에는 반차 사용 불가
  - 공휴일 포함 주에는 반차 사용 불가
  - 휴무일이 아닌 날짜에만 반차 신청 가능
  - 주 32시간 원칙 유지 확인

#### 1.4 데이터베이스 스키마
```sql
-- leaves 테이블 활용 또는 새 테이블 생성
CREATE TABLE half_day_leaves (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(100) NOT NULL,
    leave_date DATE NOT NULL,
    leave_type ENUM('HALF_AM', 'HALF_PM') NOT NULL,
    reason TEXT,
    status ENUM('PENDING', 'APPROVED', 'REJECTED') DEFAULT 'PENDING',
    approved_by VARCHAR(100),
    approved_at DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(email),
    FOREIGN KEY (approved_by) REFERENCES users(email)
);
```

#### 1.5 API 엔드포인트
- `POST /api/staff/half-day-leaves`: 반차 신청
- `GET /api/staff/half-day-leaves`: 반차 신청 목록 조회
- `PUT /api/staff/half-day-leaves/:id/approve`: 반차 승인
- `PUT /api/staff/half-day-leaves/:id/reject`: 반차 거부
- `DELETE /api/staff/half-day-leaves/:id`: 반차 신청 취소

---

### Phase 2: 일시적 휴무일 변경 시스템 (우선순위: 중간)

#### 2.1 일시적 변경 신청
- **목적**: 특정 주의 휴무일을 다른 요일로 변경
- **기능**:
  - 변경할 주 선택
  - 원래 휴무일 → 새 휴무일 선택
  - 변경 사유 입력
  - 승인 대기 상태

#### 2.2 일시적 변경 승인
- **목적**: 관리자가 변경 신청 승인/거부
- **기능**:
  - 변경 신청 목록 조회
  - 승인/거부 처리
  - 승인 시 해당 주 스케줄 업데이트

#### 2.3 검증 로직
- **검증 항목**:
  - 공휴일 포함 주에는 변경 불가
  - 사이클 계산에 영향 없음 (해당 주만 변경)
  - 중복 변경 방지

#### 2.4 데이터베이스 스키마
```sql
-- work_schedules 테이블에 temporary_off_day 컬럼 활용
-- 또는 새 테이블 생성
CREATE TABLE temporary_schedule_changes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(100) NOT NULL,
    week_start_date DATE NOT NULL,
    original_off_day TINYINT NOT NULL,
    temporary_off_day TINYINT NOT NULL,
    reason TEXT,
    status ENUM('PENDING', 'APPROVED', 'REJECTED') DEFAULT 'PENDING',
    approved_by VARCHAR(100),
    approved_at DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(email),
    FOREIGN KEY (approved_by) REFERENCES users(email)
);
```

#### 2.5 API 엔드포인트
- `POST /api/staff/temporary-changes`: 일시적 변경 신청
- `GET /api/staff/temporary-changes`: 변경 신청 목록 조회
- `PUT /api/staff/temporary-changes/:id/approve`: 변경 승인
- `PUT /api/staff/temporary-changes/:id/reject`: 변경 거부

---

### Phase 3: 관리자용 전체 스케줄 관리 (우선순위: 중간)

#### 3.1 전체 직원 스케줄 조회
- **목적**: 관리자가 모든 직원의 스케줄을 한눈에 확인
- **기능**:
  - 월별 전체 직원 스케줄 캘린더 뷰
  - 부서별 필터링
  - 휴무일별 색상 구분
  - 공휴일 표시

#### 3.2 스케줄 충돌 검사
- **목적**: 부서별 인력 부족 방지
- **기능**:
  - 특정 날짜 휴무 직원 수 확인
  - 최소 인력 기준 설정
  - 충돌 알림

#### 3.3 통계 대시보드
- **목적**: 스케줄 관련 통계 제공
- **기능**:
  - 요일별 휴무 직원 수 통계
  - 부서별 휴무 분포
  - 반차 사용 통계
  - 일시적 변경 통계

#### 3.4 API 엔드포인트
- `GET /api/staff/work-schedules/all`: 전체 직원 스케줄 조회
- `GET /api/staff/work-schedules/conflicts`: 스케줄 충돌 검사
- `GET /api/staff/work-schedules/statistics`: 스케줄 통계

---

### Phase 4: 공휴일 관리 개선 (우선순위: 낮음)

#### 4.1 음력 공휴일 자동 계산
- **목적**: 설날, 추석, 부처님오신날 자동 계산
- **기능**:
  - 음력 → 양력 변환 라이브러리 연동
  - 연도별 음력 공휴일 자동 생성
  - 수동 수정 가능

#### 4.2 대량 입력 기능
- **목적**: 엑셀 파일로 여러 공휴일 한번에 추가
- **기능**:
  - 엑셀 파일 업로드
  - 데이터 파싱 및 검증
  - 일괄 추가

#### 4.3 공휴일 템플릿
- **목적**: 연도별 공휴일 템플릿 저장 및 적용
- **기능**:
  - 템플릿 저장
  - 템플릿 적용
  - 템플릿 수정

---

### Phase 5: 알림 및 알림 시스템 (우선순위: 낮음)

#### 5.1 스케줄 알림
- **목적**: 직원에게 다음 주 휴무일 알림
- **기능**:
  - 주간 휴무일 알림
  - 사이클 변경 알림
  - 반차 승인/거부 알림

#### 5.2 관리자 알림
- **목적**: 관리자에게 중요한 이벤트 알림
- **기능**:
  - 반차 신청 알림
  - 일시적 변경 신청 알림
  - 스케줄 충돌 알림

---

## 📊 개발 일정 추정

### Phase 1: 반차 신청/승인 시스템
- **예상 기간**: 1-2주
- **작업 내용**:
  - [ ] 데이터베이스 스키마 설계 및 생성
  - [ ] API 엔드포인트 개발
  - [ ] 프론트엔드 페이지 개발
  - [ ] 검증 로직 구현
  - [ ] 테스트

### Phase 2: 일시적 휴무일 변경 시스템
- **예상 기간**: 1주
- **작업 내용**:
  - [ ] 데이터베이스 스키마 설계 및 생성
  - [ ] API 엔드포인트 개발
  - [ ] 프론트엔드 페이지 개발
  - [ ] 검증 로직 구현
  - [ ] 테스트

### Phase 3: 관리자용 전체 스케줄 관리
- **예상 기간**: 1-2주
- **작업 내용**:
  - [ ] 캘린더 뷰 컴포넌트 개발
  - [ ] 충돌 검사 로직 구현
  - [ ] 통계 대시보드 개발
  - [ ] API 엔드포인트 개발
  - [ ] 테스트

### Phase 4: 공휴일 관리 개선
- **예상 기간**: 1주
- **작업 내용**:
  - [ ] 음력 변환 라이브러리 연동
  - [ ] 엑셀 업로드 기능 개발
  - [ ] 템플릿 기능 개발
  - [ ] 테스트

### Phase 5: 알림 시스템
- **예상 기간**: 1주
- **작업 내용**:
  - [ ] 알림 시스템 설계
  - [ ] 이메일/푸시 알림 구현
  - [ ] 알림 설정 페이지 개발
  - [ ] 테스트

---

## 🔧 기술 스택

### 백엔드
- **프레임워크**: Express.js
- **데이터베이스**: MySQL
- **인증**: 세션 기반 인증
- **검증**: express-validator (추가 고려)

### 프론트엔드
- **프레임워크**: Vanilla JavaScript
- **UI 라이브러리**: Bootstrap 5
- **캘린더**: FullCalendar.js (Phase 3에서 사용 고려)
- **차트**: Chart.js (통계 대시보드용)

### 외부 라이브러리
- **음력 변환**: `korean-lunar-calendar` 또는 `lunar-calendar` (Phase 4)
- **엑셀 파싱**: `xlsx` 또는 `exceljs` (Phase 4)

---

## 📝 참고 사항

### 기존 코드 활용
- `work-schedule-helpers.js`의 검증 함수 재사용
- `work-schedules.js`의 스케줄 조회 로직 확장
- `holidays.js`의 공휴일 조회 로직 활용

### 데이터베이스 마이그레이션
- 각 Phase마다 마이그레이션 스크립트 작성
- 롤백 계획 수립

### 테스트 계획
- 단위 테스트 (각 함수별)
- 통합 테스트 (API 엔드포인트별)
- E2E 테스트 (사용자 시나리오별)

---

## 🎯 최종 목표

주 4일 근무제 시스템을 완전히 자동화하여:
1. 직원이 쉽게 스케줄을 확인하고 반차를 신청할 수 있음
2. 관리자가 전체 스케줄을 관리하고 충돌을 방지할 수 있음
3. 공휴일 관리가 자동화되어 운영 부담이 최소화됨
4. 모든 규칙이 시스템에서 자동으로 검증됨

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-12-28  
**작성자**: 시스템 개발팀

