# 타임존(TZ) 환경 변수 설정 가이드

**작성일**: 2025-12-28  
**목적**: 주 4일 근무제 시스템의 타임존 설정 방법

---

## 1. 현재 설정 상태

`server.js`에서 이미 타임존을 설정하고 있습니다:
```javascript
process.env.TZ = 'Asia/Seoul';
require('dotenv').config();
```

하지만 `work-schedule-helpers.js`가 `server.js`보다 먼저 로드될 수 있으므로, 여러 방법으로 설정하는 것이 좋습니다.

---

## 2. 설정 방법

### 방법 1: `.env` 파일 사용 (권장)

#### 2.1 `.env` 파일 생성
프로젝트 루트에 `.env` 파일 생성:

```bash
# .env 파일
TZ=Asia/Seoul
NODE_ENV=development
PORT=3000
```

#### 2.2 `server.js` 수정
`dotenv`를 먼저 로드한 후 타임존 설정:

```javascript
// dotenv를 가장 먼저 로드
require('dotenv').config();

// 타임존 설정 (dotenv 로드 후)
process.env.TZ = process.env.TZ || 'Asia/Seoul';
```

---

### 방법 2: package.json scripts에서 설정

#### Windows (PowerShell/CMD)
```json
{
  "scripts": {
    "start": "set TZ=Asia/Seoul && node server.js",
    "dev": "set TZ=Asia/Seoul && nodemon server.js",
    "prod": "set TZ=Asia/Seoul && set NODE_ENV=production && node server.js"
  }
}
```

#### Linux/Mac
```json
{
  "scripts": {
    "start": "TZ=Asia/Seoul node server.js",
    "dev": "TZ=Asia/Seoul nodemon server.js",
    "prod": "TZ=Asia/Seoul NODE_ENV=production node server.js"
  }
}
```

#### 크로스 플랫폼 (cross-env 사용)
```bash
npm install --save-dev cross-env
```

```json
{
  "scripts": {
    "start": "cross-env TZ=Asia/Seoul node server.js",
    "dev": "cross-env TZ=Asia/Seoul nodemon server.js",
    "prod": "cross-env TZ=Asia/Seoul NODE_ENV=production node server.js"
  }
}
```

---

### 방법 3: 시스템 환경 변수 설정

#### Windows
```powershell
# PowerShell에서
[System.Environment]::SetEnvironmentVariable('TZ', 'Asia/Seoul', 'User')

# 또는 CMD에서
setx TZ "Asia/Seoul"
```

#### Linux/Mac
```bash
# ~/.bashrc 또는 ~/.zshrc에 추가
export TZ=Asia/Seoul

# 적용
source ~/.bashrc
```

---

### 방법 4: work-schedule-helpers.js에서 직접 설정

`work-schedule-helpers.js` 파일 상단에 추가:

```javascript
// 타임존 설정 (가장 먼저 실행)
if (!process.env.TZ || process.env.TZ !== 'Asia/Seoul') {
  process.env.TZ = 'Asia/Seoul';
  console.log('✅ 타임존이 Asia/Seoul로 설정되었습니다.');
}
```

---

## 3. 권장 설정 방법

### 3.1 개발 환경
1. `.env` 파일 생성 및 `TZ=Asia/Seoul` 추가
2. `server.js`에서 `dotenv` 먼저 로드 후 타임존 설정
3. `package.json` scripts에서도 설정 (이중 보장)

### 3.2 프로덕션 환경
1. 시스템 환경 변수 설정
2. `.env` 파일 사용 (보안 주의)
3. 배포 플랫폼(Heroku, AWS 등)의 환경 변수 설정

---

## 4. 설정 확인 방법

### 4.1 서버 시작 시 확인
`server.js`에서 확인:
```javascript
console.log(`  - TZ: ${process.env.TZ}`);
```

### 4.2 런타임 확인
```javascript
console.log('현재 타임존:', process.env.TZ);
console.log('현재 시간:', new Date().toString());
```

### 4.3 테스트
```bash
node -e "process.env.TZ='Asia/Seoul'; console.log(new Date().toString())"
```

---

## 5. 문제 해결

### 문제 1: 타임존이 설정되지 않음
**원인**: `dotenv`가 타임존 설정 전에 로드되지 않음  
**해결**: `server.js`에서 `dotenv`를 가장 먼저 로드

### 문제 2: Windows에서 `set` 명령어가 작동하지 않음
**원인**: Windows CMD와 PowerShell의 환경 변수 설정 방법이 다름  
**해결**: `cross-env` 패키지 사용

### 문제 3: 프로덕션에서 타임존이 다름
**원인**: 배포 플랫폼의 기본 타임존이 다름  
**해결**: 배포 플랫폼의 환경 변수 설정에서 `TZ=Asia/Seoul` 설정

---

## 6. 체크리스트

- [ ] `.env` 파일에 `TZ=Asia/Seoul` 추가
- [ ] `server.js`에서 `dotenv` 먼저 로드 후 타임존 설정
- [ ] `package.json` scripts에 타임존 설정 (선택)
- [ ] 서버 시작 시 타임존 확인 로그 출력
- [ ] 테스트 실행 시 타임존 확인

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-12-28

