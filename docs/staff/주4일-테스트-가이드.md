# 주 4일 근무제 자동 테스트 가이드

**작성일**: 2025-12-28  
**목적**: 주 4일 근무제 시스템의 자동 테스트 실행 방법

---

## 1. 테스트 프레임워크 설치

### 1.1 Jest 및 Supertest 설치
```bash
npm install --save-dev jest supertest
```

### 1.2 package.json 확인
다음 스크립트가 추가되어 있는지 확인:
```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:unit": "jest tests/unit",
    "test:integration": "jest tests/integration"
  }
}
```

---

## 2. 테스트 실행 방법

### 2.1 전체 테스트 실행
```bash
npm test
```

### 2.2 단위 테스트만 실행
```bash
npm run test:unit
```

### 2.3 통합 테스트만 실행
```bash
npm run test:integration
```

### 2.4 Watch 모드 (파일 변경 시 자동 실행)
```bash
npm run test:watch
```

### 2.5 커버리지 리포트 생성
```bash
npm run test:coverage
```

### 2.6 스크립트 사용 (Windows)
```bash
# PowerShell에서
.\tests\run-tests.bat
```

---

## 3. 테스트 항목

### 3.1 단위 테스트 (`tests/unit/work-schedule-helpers.test.js`)

#### 타임존 헬퍼 함수
- `formatDate()` - 날짜 포맷팅
- `getWeekStartDate()` - 주 시작일 계산

#### 4주 사이클 계산
- `getCycleNumber()` - 사이클 번호 계산
- `getCycleWeek()` - 사이클 내 주차 계산
- `calculateOffDayByWeekCycle()` - 휴무일 계산
  - 사이클 0: 금요일 휴무
  - 사이클 1: 목요일 휴무
  - 사이클 2: 수요일 휴무
  - 사이클 3: 화요일 휴무
  - 사이클 4: 월요일 휴무
  - 사이클 5: 금요일 휴무 (순환 복귀)

#### 공휴일 처리
- `hasHolidayInWeek()` - 주에 공휴일 포함 여부
- `isHoliday()` - 특정 날짜가 공휴일인지

#### 날짜 비교
- `isSameWeek()` - 같은 주인지 확인
- `isProbationPeriod()` - 수습 기간 여부

#### 검증 함수
- `validateHalfDay()` - 반차 검증
- `validateTemporaryChange()` - 일시적 변경 검증

---

## 4. 테스트 실행 결과 예시

```
PASS  tests/unit/work-schedule-helpers.test.js
  주 4일 근무제 헬퍼 함수 테스트
    formatDate
      ✓ Date 객체를 YYYY-MM-DD 형식으로 변환 (2 ms)
      ✓ 날짜 문자열을 YYYY-MM-DD 형식으로 변환 (1 ms)
    getWeekStartDate
      ✓ 월요일이 주 시작일인지 확인 (1 ms)
      ✓ 일요일에서 월요일로 변환 (1 ms)
      ✓ 금요일에서 같은 주 월요일로 변환 (1 ms)
    getCycleNumber
      ✓ 사이클 시작일과 같은 날은 사이클 0 (1 ms)
      ✓ 28일 후는 사이클 1 (1 ms)
      ✓ 56일 후는 사이클 2 (1 ms)
    calculateOffDayByWeekCycle
      ✓ 사이클 0 (1-4주): 금요일 휴무 (1 ms)
      ✓ 사이클 1 (5-8주): 목요일 휴무 (1 ms)
      ✓ 사이클 2 (9-12주): 수요일 휴무 (1 ms)
      ✓ 사이클 3 (13-16주): 화요일 휴무 (1 ms)
      ✓ 사이클 4 (17-20주): 월요일 휴무 (1 ms)
      ✓ 사이클 5 (21-24주): 금요일 휴무 (순환 복귀) (1 ms)
    validateHalfDay
      ✓ 공휴일에 반차 신청 불가 (1 ms)
      ✓ 휴무일에 반차 신청 불가 (1 ms)
      ✓ 공휴일 포함 주에 반차 신청 불가 (1 ms)
      ✓ 같은 주 내 반차 신청 가능 (1 ms)

Test Suites: 1 passed, 1 total
Tests:       25 passed, 25 total
Snapshots:   0 total
Time:        2.345 s
```

---

## 5. 커버리지 리포트

### 5.1 커버리지 리포트 생성
```bash
npm run test:coverage
```

### 5.2 리포트 확인
- 텍스트 리포트: 터미널에 표시
- HTML 리포트: `coverage/lcov-report/index.html` 열기

### 5.3 커버리지 목표
- Branches: 70% 이상
- Functions: 70% 이상
- Lines: 70% 이상
- Statements: 70% 이상

---

## 6. CI/CD 통합

### 6.1 GitHub Actions 예시
`.github/workflows/test.yml` 파일 생성:

```yaml
name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm install
      - run: npm test
      - run: npm run test:coverage
```

---

## 7. 테스트 데이터

### 7.1 테스트용 사용자 데이터
```json
{
  "base_off_day": 5,
  "cycle_start_date": "2025-01-06",
  "initial_selection_date": "2025-01-06"
}
```

### 7.2 테스트용 공휴일 데이터
```json
[
  { "date": "2025-12-25", "name": "크리스마스" }
]
```

---

## 8. 주의사항

### 8.1 타임존 설정
- 테스트 실행 시 `process.env.TZ = 'Asia/Seoul'` 설정 확인
- 모든 날짜 계산은 KST 기준으로 수행

### 8.2 통합 테스트
- 실제 데이터베이스 연결이 필요합니다
- 테스트 전에 테스트용 데이터베이스 설정 필요
- 테스트 후 데이터 정리 필요

### 8.3 테스트 격리
- 각 테스트는 독립적으로 실행되어야 함
- 테스트 간 데이터 공유 금지

---

## 9. 문제 해결

### 문제 1: "Cannot find module" 오류
**해결 방법**:
```bash
npm install
```

### 문제 2: 타임존 관련 오류
**해결 방법**:
- `tests/setup.js` 파일 확인
- `process.env.TZ = 'Asia/Seoul'` 설정 확인

### 문제 3: 데이터베이스 연결 오류 (통합 테스트)
**해결 방법**:
- `.env` 파일에 테스트용 DB 설정 확인
- 테스트용 데이터베이스 생성

---

## 10. 테스트 추가 방법

### 10.1 새로운 테스트 케이스 추가
`tests/unit/work-schedule-helpers.test.js` 파일에 추가:

```javascript
describe('새로운 함수 테스트', () => {
  test('테스트 케이스 설명', () => {
    // Given (준비)
    const input = 'test';
    
    // When (실행)
    const result = functionToTest(input);
    
    // Then (검증)
    expect(result).toBe('expected');
  });
});
```

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-12-28

