# 주 4일 근무제 프론트엔드 구현 가이드

**작성일**: 2025-12-28  
**버전**: 1.0  
**기준 문서**: 
- `주4일-근무제-기획서.md`
- `주4일-API-스펙.md`
- `주4일-DB-스키마-설계.md`

---

## 1. 핵심 원칙

### 1.1 타임존 처리 (절대 규칙)
⚠️ **프론트엔드에서 날짜 계산 금지**
- ❌ `new Date()`로 날짜 계산 금지
- ❌ 브라우저 로컬 타임존 기준 계산 금지
- ✅ 서버에서 계산한 `daily_schedule` 데이터만 사용
- ✅ 서버에서 내려준 날짜 문자열 그대로 표시

### 1.2 데이터 소스
- 모든 스케줄 정보는 서버 API에서 받은 데이터 사용
- `daily_schedule` 배열을 그대로 사용하여 캘린더 렌더링
- 클라이언트 측 계산 로직 없음

---

## 2. 페이지 구조

### 2.1 파일 위치
- HTML: `public/pages/staff/employee-schedule.html`
- JavaScript: `public/js/staff/employee-schedule.js`
- CSS: `public/css/employee-schedule.css`

### 2.2 페이지 구성 요소

#### 헤더 영역
- 연도/월 선택 드롭다운
- 이전/다음 월 버튼
- 현재 월 표시

#### 정보 표시 영역
1. **기본 정보**
   - 기본 휴무일 표시
   - 사이클 정보 (주차 범위)
   - 현재 사이클의 휴무일

2. **알림 영역**
   - 수습 기간 알림 (입사 후 3개월 미만)
   - 공휴일 포함 주 알림

3. **액션 버튼**
   - 반차 신청 버튼
   - 일시적 휴무일 변경 버튼

#### 캘린더 영역
- 월별 캘린더 그리드
- 각 날짜별 상태 표시:
  - 근무일
  - 휴무일
  - 공휴일
  - 반차 (오전/오후)

---

## 3. API 연동

### 3.1 사용할 API 엔드포인트

#### 1. 설정 상태 확인
```javascript
GET /api/staff/work-schedules/my-status
```

#### 2. 스케줄 조회
```javascript
GET /api/staff/work-schedules/my-schedule/:year/:month
```

#### 3. 반차 신청
```javascript
POST /api/staff/work-schedules/apply-half-day
Body: {
  "date": "2025-12-15",
  "leave_type": "HALF_AM",
  "reason": "병원 방문"
}
```

#### 4. 일시적 변경 신청
```javascript
POST /api/staff/work-schedules/temporary-change
Body: {
  "week_start_date": "2025-12-15",
  "temporary_off_day": 3,
  "reason": "개인 사정",
  "substitute_employee": "substitute@example.com"
}
```

---

## 4. 데이터 처리 규칙

### 4.1 daily_schedule 사용
서버에서 받은 `daily_schedule` 배열을 그대로 사용:

```javascript
// daily_schedule 예시
[
  {
    "date": "2025-12-01",
    "day_of_week": 1,
    "off_day": 4,
    "is_off_day": false,
    "is_holiday": false,
    "has_half_day": false,
    "half_day_type": null
  },
  {
    "date": "2025-12-04",
    "day_of_week": 4,
    "off_day": 4,
    "is_off_day": true,
    "is_holiday": false,
    "has_half_day": false,
    "half_day_type": null
  }
]
```

### 4.2 캘린더 렌더링 로직
```javascript
function renderCalendar(dailySchedule) {
  // daily_schedule을 Map으로 변환 (빠른 조회)
  const scheduleMap = new Map(
    dailySchedule.map(item => [item.date, item])
  );
  
  // 각 날짜별로 스케줄 정보 확인
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const daySchedule = scheduleMap.get(dateStr);
    
    if (daySchedule) {
      // 서버에서 계산한 정보 사용
      if (daySchedule.is_holiday) {
        // 공휴일 표시
      } else if (daySchedule.has_half_day) {
        // 반차 표시
      } else if (daySchedule.is_off_day) {
        // 휴무일 표시
      } else {
        // 근무일 표시
      }
    }
  }
}
```

---

## 5. UI 컴포넌트

### 5.1 반차 신청 모달
- 날짜 선택 (같은 주 내에서만)
- 반차 타입 선택 (오전/오후)
- 사유 입력
- 검증 메시지 표시 영역

### 5.2 일시적 변경 모달
- 주 시작일 표시 (자동 계산)
- 원래 휴무일 표시 (자동 계산)
- 임시 휴무일 선택
- 대체 직원 선택 (선택사항)
- 변경 사유 입력

---

## 6. 에러 처리

### 6.1 API 에러 처리
```javascript
try {
  const response = await fetch('/api/staff/work-schedules/my-schedule/2025/12');
  const data = await response.json();
  
  if (!data.success) {
    // 에러 코드에 따른 처리
    switch (data.code) {
      case 'UNAUTHORIZED':
        // 로그인 페이지로 리다이렉트
        break;
      case 'WORK_DAYS_NOT_SET':
        // 초기 설정 안내
        break;
      default:
        // 일반 에러 메시지 표시
    }
  }
} catch (error) {
  // 네트워크 오류 등
}
```

---

## 7. 구현 체크리스트

### 필수 구현 항목
- [ ] 페이지 기본 구조 (HTML)
- [ ] API 연동 (JavaScript)
- [ ] 캘린더 렌더링 (daily_schedule 기반)
- [ ] 반차 신청 모달
- [ ] 일시적 변경 모달
- [ ] 에러 처리
- [ ] 로딩 상태 표시

### 스타일링
- [ ] 기본 레이아웃
- [ ] 캘린더 스타일
- [ ] 상태별 색상 구분
- [ ] 반응형 디자인

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-12-28

