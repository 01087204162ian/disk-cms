# 공휴일 포함 주 반차 사용 영향 분석

**작성일**: 2025-12-28  
**버전**: 1.0

---

## 개요

공휴일 포함 주에 반차를 사용할 수 있도록 변경되었습니다. 이 문서는 공휴일 포함 주에 반차를 사용했을 때의 영향과 처리 방안을 설명합니다.

---

## 공휴일 포함 주의 특성

### 기본 규칙

1. **주 4일 근무 유지**
   - 공휴일이 포함된 주도 주 4일 근무를 유지합니다
   - 공휴일이 있는 날은 공휴일로 쉬므로, 이미 1일을 쉬게 됨
   - 별도로 휴무일을 제공할 필요가 없음 (공휴일로 이미 주 4일 근무 달성)
   - 예: 공휴일(목) → 목요일은 공휴일로 쉼 → 나머지 평일 4일 근무 = 주 4일 근무

2. **사이클 계산 제외**
   - 공휴일 포함 주는 4주 사이클 계산에서 제외됩니다
   - 사이클 번호 계산에 포함되지 않습니다

3. **휴무일 미적용**
   - 공휴일 포함 주에서는 휴무일을 적용하지 않습니다
   - 이유: 공휴일로 이미 1일을 쉬므로 별도 휴무일 불필요

---

## 공휴일 포함 주에 반차 사용 시 영향

### 시나리오 1: 공휴일 포함 주에 반차 사용

**예시**: 2026년 1월 첫째 주 (2026-01-05 ~ 2026-01-11)
- 공휴일: 2026-01-01 (신정, 목요일) - 이전 주이지만 주 범위에 포함될 수 있음
- 또는: 해당 주에 공휴일이 있는 경우

**반차 사용 전** (예: 공휴일 목요일):
- 월요일: 8시간 근무
- 화요일: 8시간 근무
- 수요일: 8시간 근무
- 목요일: 공휴일 (쉼)
- 금요일: 8시간 근무
- **총 근무 시간: 32시간** (주 4일 근무: 공휴일 1일 + 평일 4일 근무)

**반차 사용 후** (예: 수요일 오후 반차):
- 월요일: 8시간 근무
- 화요일: 8시간 근무
- 수요일: 4시간 근무 (오후 반차, 14시 퇴근)
- 목요일: 공휴일 (쉼)
- 금요일: 8시간 근무
- **총 근무 시간: 28시간** (4시간 부족)
- **차주 보충 필요**: 다음 주 휴무일 중 반나절(4시간) 회수

### 영향 분석

#### 1. 근무 시간 감소
- **정상**: 32시간 (주 4일 근무: 공휴일 1일 + 평일 4일 근무)
- **반차 사용**: 28시간 (4시간 감소)
- **차이**: 4시간 부족

#### 2. 주 32시간 원칙과의 관계
- 공휴일 포함 주도 주 4일 근무(32시간)를 유지합니다
- 반차를 사용하면 28시간이 되어 주 4일 근무 원칙(32시간)보다 4시간 부족합니다

#### 3. 급여/근태 처리
- 반차 사용 시 해당 날은 0.5일로 처리됩니다
- `leaves` 테이블에 `days_count: 0.5`로 기록됩니다
- 실제 근무 시간은 4시간으로 계산됩니다

---

## 권장 처리 방안

### 방안 1: 허용 + 차주 보충 (권장)

**개념**:
- 공휴일 포함 주에 반차 사용 시 부족한 4시간을 다음 주에 보충

**예시**:
- 1주차 (공휴일 포함): 28시간 (반차 사용)
- 2주차: 36시간 (다음 주 휴무일에 4시간 추가 근무)
- **2주 평균: 32시간** ✅

**장점**:
- 주 4일 근무 원칙 유지 (2주 평균 32시간)
- 유연한 근무 관리 가능
- 직원의 개인 사정 반영 가능

**구현 필요**:
- 차주 보충 로직 추가
- 보충 근무 일정 관리
- 다음 주 휴무일 중 반나절(4시간) 회수 기능

### 방안 2: 제한적 허용

**개념**:
- 공휴일 포함 주에는 반차 사용을 제한
- 특정 조건에서만 허용 (예: 공휴일이 아닌 날에만)

**구현 필요**:
- 검증 로직 수정
- 공휴일이 아닌 날에만 반차 사용 허용

**단점**:
- 유연성 감소
- 직원의 개인 사정 반영 어려움

---

## 현재 시스템 동작

### 검증 로직

```javascript
// work-schedule-helpers.js의 validateHalfDay 함수
// 1. 공휴일에는 반차 사용 불가 ✅
// 2. 공휴일 포함 주에는 반차 사용 가능 ✅ (변경됨)
// 3. 휴무일에 반차 사용 가능 ✅ (변경됨)
```

### 스케줄 표시

```javascript
// work-schedules.js의 daily_schedule 생성
{
  date: "2026-01-06",
  day_of_week: 3, // 수요일
  is_off_day: false, // 공휴일 포함 주는 휴무일 없음 (공휴일로 이미 1일 쉼)
  is_holiday: false,
  has_half_day: true, // 반차 사용
  half_day_type: "HALF_PM" // 오후 반차
}
```

### 데이터 저장

```sql
-- leaves 테이블에 반차 기록
INSERT INTO leaves (
  user_id, 
  leave_type, 
  start_date, 
  end_date, 
  days_count, 
  reason, 
  status
) VALUES (
  'sj2@simg.kr',
  'HALF_PM',
  '2026-01-06',
  '2026-01-06',
  0.5,  -- 반차는 0.5일
  '개인 사정',
  'PENDING'
);
```

---

## 실제 사용 시나리오

### 시나리오 1: 공휴일 포함 주에 반차 사용

**상황**: 
- 2026년 1월 첫째 주 (공휴일 포함)
- 수요일에 개인 사정으로 오후 반차 필요

**처리**:
1. 반차 신청 (수요일 오후 반차)
2. 승인 후 해당 날 4시간 근무
3. 나머지 날은 정상 근무 (8시간)
4. 총 근무 시간: 28시간 (4시간 부족)

**영향**:
- 주 4일 근무 원칙과 충돌 (32시간 → 28시간)
- 다음 주 휴무일 중 반나절(4시간) 회수 필요
- 차주 보충을 통해 2주 평균 32시간 유지

### 시나리오 2: 공휴일 포함 주에 반차 사용 (차주 보충)

**상황**:
- 공휴일 포함 주에 반차 사용
- 다음 주 휴무일 중 반나절 회수

**처리**:
1. 1주차: 반차 사용 → 28시간 근무
2. 2주차: 다음 주 휴무일에 4시간 추가 근무 → 36시간 근무
3. **2주 평균: 32시간** ✅

**영향**:
- 주 4일 근무 원칙 유지 (2주 평균 32시간)
- 차주 보충 로직 필요

---

## 권장 사항

### 1. 근무 시간 관리

**옵션 A: 차주 보충 (권장)**
- 공휴일 포함 주에 반차 사용 시 부족한 4시간을 다음 주에 보충
- 다음 주 휴무일 중 반나절(4시간) 회수
- 2주 평균 32시간 유지

**옵션 B: 별도 관리**
- 공휴일 포함 주의 반차 사용은 별도로 관리
- 근태 시스템에서 특별 처리

**옵션 C: 제한 없음**
- 현재처럼 허용하되, 근무 시간 차이는 인정
- 주 4일 근무 원칙보다 개인 사정 우선
- 권장하지 않음 (주 4일 근무 원칙 위배)

### 2. 시스템 개선 제안

1. **차주 보충 기능 추가**
   - 반차 사용 시 자동으로 차주 보충 일정 생성
   - 관리자 승인 후 보충 근무 진행

2. **근무 시간 통계 개선**
   - 공휴일 포함 주의 반차 사용을 별도로 집계
   - 주간/월간 근무 시간 리포트에 반영

3. **알림 기능**
   - 공휴일 포함 주에 반차 사용 시 관리자에게 알림
   - 근무 시간 부족 경고

---

## 결론

### 현재 상태

✅ **공휴일 포함 주에 반차 사용 가능**
- 검증 로직에서 허용됨
- 시스템에서 정상적으로 처리됨

⚠️ **근무 시간 영향**
- 주 4일 근무(32시간) → 반차 사용 시 28시간
- 4시간 부족 발생
- 차주 보충 필요 (다음 주 휴무일 중 반나절 회수)

### 향후 개선 방향

1. **단기**: 현재 상태 유지 (허용)
   - 유연한 근무 관리
   - 개인 사정 반영

2. **중기**: 차주 보충 기능 추가
   - 자동 보충 일정 생성
   - 근무 시간 균형 유지

3. **장기**: 근무 시간 통계 개선
   - 공휴일 포함 주 반차 사용 별도 집계
   - 리포트 및 알림 기능 강화

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-12-28  
**작성자**: 시스템 개발팀

