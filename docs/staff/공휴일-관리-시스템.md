# 공휴일 관리 시스템

## 개요

주 4일 근무제 시스템에서 사용하는 공휴일을 관리하는 시스템입니다. 관리자는 공휴일을 추가, 수정, 삭제할 수 있으며, 대체 공휴일을 자동 생성하고 데이터를 검증할 수 있습니다.

## 구현 일자

2025-12-28

## 주요 기능

### 1. 공휴일 CRUD
- **조회**: 연도, 날짜 범위로 필터링하여 공휴일 목록 조회
- **추가**: 새로운 공휴일 추가 (날짜, 이름, 연도)
- **수정**: 기존 공휴일 정보 수정 (이름, 활성화 상태)
- **삭제**: 공휴일 비활성화 (실제 삭제가 아닌 is_active = 0)

### 2. 대체 공휴일 자동 생성
- 주말(토요일, 일요일)에 있는 공휴일의 경우 다음 평일을 대체 공휴일로 자동 생성
- 1년 이내의 날짜만 생성
- 이미 존재하는 대체 공휴일은 중복 생성하지 않음

### 3. 데이터 검증
- 고정 공휴일 누락 확인
- 날짜와 연도 일치 여부 확인
- 중복 날짜 확인
- 공휴일 이름 일치 여부 경고

## 파일 구조

### 백엔드
- `routes/staff/holidays.js`: 공휴일 관리 API 라우트
  - `GET /api/staff/holidays`: 공휴일 목록 조회
  - `POST /api/staff/holidays`: 공휴일 추가
  - `PUT /api/staff/holidays/:id`: 공휴일 수정
  - `DELETE /api/staff/holidays/:id`: 공휴일 삭제(비활성화)
  - `POST /api/staff/holidays/generate-substitute`: 대체 공휴일 자동 생성
  - `GET /api/staff/holidays/validate`: 데이터 검증

### 프론트엔드
- `public/pages/staff/holidays.html`: 공휴일 관리 페이지
- `public/js/staff/holidays.js`: 공휴일 관리 JavaScript 클래스

### 메뉴
- `public/components/sj-sidebar.html`: 사이드바에 "공휴일 관리" 메뉴 추가
- `public/js/sj-template-loader.js`: 권한별 메뉴 표시 로직 추가

## 권한 관리

### 접근 권한
- **공휴일 목록 조회**: 모든 로그인 사용자 (`requireAuth`)
- **공휴일 추가/수정/삭제**: SUPER_ADMIN, SYSTEM_ADMIN만 가능 (`requireRole`)
- **대체 공휴일 생성**: SUPER_ADMIN, SYSTEM_ADMIN만 가능
- **데이터 검증**: SUPER_ADMIN, SYSTEM_ADMIN만 가능

### 메뉴 표시
- 사이드바의 "공휴일 관리" 메뉴는 SUPER_ADMIN, SYSTEM_ADMIN만 표시됨
- `data-roles="SUPER_ADMIN,SYSTEM_ADMIN"` 속성으로 제어

## 데이터베이스

### holidays 테이블
```sql
CREATE TABLE holidays (
  id INT PRIMARY KEY AUTO_INCREMENT,
  holiday_date DATE NOT NULL UNIQUE,
  name VARCHAR(100) NOT NULL,
  year INT NOT NULL,
  is_active TINYINT(1) DEFAULT 1
);
```

**참고**: 실제 데이터베이스에는 `created_at`, `updated_at` 컬럼이 없으므로 쿼리에서 제외됨

## 고정 공휴일 목록

매년 동일한 날짜의 공휴일:
- 신정 (1월 1일)
- 삼일절 (3월 1일)
- 어린이날 (5월 5일)
- 현충일 (6월 6일)
- 광복절 (8월 15일)
- 개천절 (10월 3일)
- 한글날 (10월 9일)
- 성탄절 (12월 25일)

## 음력 공휴일

매년 날짜가 변동되는 공휴일 (수동 입력 필요):
- 설날 (음력 1월 1일)
- 추석 (음력 8월 15일)
- 부처님오신날 (음력 4월 8일)

## 사용 방법

### 1. 공휴일 추가
1. "공휴일 추가" 버튼 클릭
2. 날짜, 공휴일명, 연도 입력
3. 저장

### 2. 대체 공휴일 자동 생성
1. 연도 필터 선택
2. "대체 공휴일 자동 생성" 버튼 클릭
3. 해당 연도의 주말 공휴일의 대체 공휴일이 자동 생성됨

### 3. 데이터 검증
1. 연도 필터 선택
2. "데이터 검증" 버튼 클릭
3. 검증 결과 모달에서 오류 및 경고 확인

## 기술 스택

- **백엔드**: Express.js, MySQL2
- **프론트엔드**: Vanilla JavaScript, Bootstrap 5
- **템플릿 시스템**: sj-template-loader.js
- **인증**: 세션 기반 인증 (middleware/auth.js)

## 주요 구현 사항

### 1. 기존 staff 페이지 구조 준수
- `employees.html`과 동일한 레이아웃 구조 사용
- 테이블 및 모바일 카드 렌더링 지원
- `sj-template-loader.js` 패턴 준수

### 2. 권한 체크
- 서버 사이드 권한 체크 (`requireRole` 미들웨어)
- 클라이언트 사이드 메뉴 표시 제어 (`data-roles` 속성)

### 3. 사용자 경험
- Toast 알림 사용 (sj-template-loader의 showToast)
- 로딩 상태 표시 (sj-template-loader의 showPageLoading)
- 반응형 디자인 (데스크톱 테이블 + 모바일 카드)

## 향후 개선 사항

1. **음력 공휴일 자동 계산**: 음력 날짜를 양력으로 자동 변환하는 기능
2. **대량 입력**: 엑셀 파일 업로드로 여러 공휴일을 한 번에 추가
3. **공휴일 템플릿**: 연도별 공휴일 템플릿 저장 및 적용
4. **알림**: 다음 연도 공휴일이 부족할 때 알림 표시

## 관련 문서

- [주 4일 근무제 통합 가이드](./주4일-근무제-통합-가이드.md)
- [직원 관리 시스템 분석](./staff-시스템-분석.md)

