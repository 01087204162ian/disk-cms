# 주 4일 근무제 기본 휴무일 설정 규칙

**작성일**: 2025-12-28  
**버전**: 1.0  
**목적**: 정식 직원이 오늘 날짜에 기본 휴무일을 설정했을 때의 규칙 적용 방법

---

## 1. 기본 규칙 요약

정식 직원이 오늘 날짜에 기본 휴무일을 설정하면:

1. **`cycle_start_date`**: 오늘이 포함된 주의 **월요일**로 자동 설정
2. **`base_off_day`**: 사용자가 선택한 요일 (1=월, 2=화, 3=수, 4=목, 5=금)
3. **`initial_selection_date`**: 오늘 날짜 저장
4. **4주 사이클**: `cycle_start_date`부터 28일(4주) 단위로 순환

---

## 2. 상세 규칙

### 2.1 cycle_start_date 계산 규칙

#### 케이스 1: 오늘이 평일(월~금)인 경우
- **`cycle_start_date` = 이번 주 월요일**
- 예: 오늘이 2025-12-30 (화요일)이면
  - `cycle_start_date = 2025-12-29` (월요일)

#### 케이스 2: 오늘이 토요일인 경우
- **`cycle_start_date` = 다음 주 월요일**
- 예: 오늘이 2025-12-27 (토요일)이면
  - `cycle_start_date = 2025-12-29` (월요일)

#### 케이스 3: 오늘이 일요일인 경우
- **`cycle_start_date` = 다음 주 월요일**
- 예: 오늘이 2025-12-28 (일요일)이면
  - `cycle_start_date = 2025-12-29` (월요일)

**핵심**: `cycle_start_date`는 항상 **월요일**로 설정됨

---

### 2.2 base_off_day 설정

- 사용자가 선택한 요일이 그대로 저장됨
- **1주차~4주차**: 선택한 요일이 휴무일
- **5주차~8주차**: 시프트 순환 시작 (금→목→수→화→월)

---

### 2.3 4주 사이클 적용

#### 사이클 번호 계산
```
cycle_number = floor((주_시작일 - cycle_start_date) / 28일)
```

#### 휴무일 시프트 순서
- **사이클 0 (1-4주차)**: 선택한 `base_off_day` 고정
- **사이클 1 (5-8주차)**: 시프트 순환 시작
  - 순서: 금(5) → 목(4) → 수(3) → 화(2) → 월(1) → 금(5)

---

## 3. 실제 예시

### 예시 1: 오늘이 화요일(2025-12-30), 금요일 선택

#### 설정 값
```json
{
  "base_off_day": 5,  // 금요일
  "cycle_start_date": "2025-12-29",  // 이번 주 월요일
  "initial_selection_date": "2025-12-30"  // 오늘
}
```

#### 적용 결과

**1주차 (2025-12-29 ~ 2026-01-04)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- 목: 근무일
- **금: 휴무일** ✅ (base_off_day = 5)

**2주차 (2026-01-05 ~ 2026-01-11)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- 목: 근무일
- **금: 휴무일** ✅

**3주차 (2026-01-12 ~ 2026-01-18)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- 목: 근무일
- **금: 휴무일** ✅

**4주차 (2026-01-19 ~ 2026-01-25)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- 목: 근무일
- **금: 휴무일** ✅

**5주차 (2026-01-26 ~ 2026-02-01)** - 사이클 1 시작
- 월: 근무일
- 화: 근무일
- 수: 근무일
- **목: 휴무일** ✅ (시프트: 금→목)
- 금: 근무일

---

### 예시 2: 오늘이 일요일(2025-12-28), 목요일 선택

#### 설정 값
```json
{
  "base_off_day": 4,  // 목요일
  "cycle_start_date": "2025-12-29",  // 다음 주 월요일
  "initial_selection_date": "2025-12-28"  // 오늘
}
```

#### 적용 결과

**1주차 (2025-12-29 ~ 2026-01-04)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- **목: 휴무일** ✅ (base_off_day = 4)
- 금: 근무일
- **참고**: 이 주에 1월 1일(목요일) 공휴일 포함 → 주 4일 근무 해제

**2주차 (2026-01-05 ~ 2026-01-11)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- **목: 휴무일** ✅
- 금: 근무일

**3주차 (2026-01-12 ~ 2026-01-18)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- **목: 휴무일** ✅
- 금: 근무일

**4주차 (2026-01-19 ~ 2026-01-25)**
- 월: 근무일
- 화: 근무일
- 수: 근무일
- **목: 휴무일** ✅
- 금: 근무일

**5주차 (2026-01-26 ~ 2026-02-01)** - 사이클 1 시작
- 월: 근무일
- 화: 근무일
- **수: 휴무일** ✅ (시프트: 목→수)
- 목: 근무일
- 금: 근무일

---

## 4. 공휴일 포함 주 처리

### 규칙
- 공휴일이 포함된 주는 **해당 주만** 주 4일 근무 해제
- 사이클(4주)은 유지됨
- 다음 주부터 다시 주 4일 근무 적용

### 예시
- **1주차**에 공휴일(1월 1일) 포함
  - 1주차: 모든 날짜 `is_off_day: false` (주 4일 근무 해제)
  - 2주차: 정상적으로 `base_off_day` 적용

---

## 5. 시프트 순환 로직

### 시프트 순서
```
금요일(5) → 목요일(4) → 수요일(3) → 화요일(2) → 월요일(1) → 금요일(5) (순환)
```

### 사이클별 휴무일 (base_off_day = 5인 경우)
| 사이클 | 주차 | 휴무일 | 계산 |
|--------|------|--------|------|
| 0 | 1-4주차 | 금요일(5) | base_off_day 고정 |
| 1 | 5-8주차 | 목요일(4) | 시프트: 금→목 |
| 2 | 9-12주차 | 수요일(3) | 시프트: 목→수 |
| 3 | 13-16주차 | 화요일(2) | 시프트: 수→화 |
| 4 | 17-20주차 | 월요일(1) | 시프트: 화→월 |
| 5 | 21-24주차 | 금요일(5) | 순환 복귀 |

### 계산 공식
```javascript
// 시프트 순서 배열
const shiftOrder = [5, 4, 3, 2, 1]; // 금, 목, 수, 화, 월

// 사이클 번호 계산
const cycleNumber = getCycleNumber(cycleStartDate, weekStart);

// 사이클 0인 경우 base_off_day 사용
if (cycleNumber === 0) {
  return baseOffDay;
}

// base_off_day의 시프트 순서 내 인덱스 찾기
const baseIndex = shiftOrder.indexOf(baseOffDay);

// 사이클 번호에 따른 시프트 인덱스 계산
// 사이클 1: baseIndex - 1, 사이클 2: baseIndex - 2, ...
const shiftIndex = (baseIndex - (cycleNumber - 1) + 5) % 5;

// 현재 사이클의 휴무일
const currentOffDay = shiftOrder[shiftIndex];
```

**핵심 규칙**:
1. **사이클 0 (1-4주차)**: `base_off_day` 고정 사용
2. **사이클 1 이상**: 시프트 순서에 따라 `base_off_day`에서 역순으로 이동
3. **시프트 방향**: 금→목→수→화→월→금 (역순)

---

## 6. 요약

### 핵심 규칙
1. ✅ `cycle_start_date`는 항상 **월요일**로 설정
2. ✅ 오늘이 주말이면 다음 주 월요일로 설정
3. ✅ `base_off_day`는 사용자가 선택한 요일 그대로 저장
4. ✅ **1-4주차**: 선택한 요일 고정 휴무일
5. ✅ **5주차부터**: 시프트 순환 시작 (금→목→수→화→월)
6. ✅ 공휴일 포함 주는 해당 주만 주 4일 근무 해제

### 데이터 저장 형식
```json
{
  "base_off_day": 5,
  "cycle_start_date": "2025-12-29",
  "initial_selection_date": "2025-12-30"
}
```

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-12-28

