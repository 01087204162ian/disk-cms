# 주4일 근무제 시스템 고도화 개발 계획

**작성일**: 2025-01-XX  
**버전**: 1.0

---

## 📋 목차

1. [개발 단계별 계획](#1-개발-단계별-계획)
2. [우선순위](#2-우선순위)
3. [마이그레이션 계획](#3-마이그레이션-계획)
4. [API 개발 계획](#4-api-개발-계획)
5. [프론트엔드 개발 계획](#5-프론트엔드-개발-계획)
6. [테스트 계획](#6-테스트-계획)

---

## 1. 개발 단계별 계획

### Phase 1: 데이터베이스 마이그레이션 (1주)

**목표**: 새로운 운영 원칙을 지원하는 데이터베이스 구조 준비

**작업 내용**:
1. ✅ DB 스키마 분석 완료
2. ⏳ 마이그레이션 SQL 스크립트 작성
3. ⏳ 개발 환경에 마이그레이션 적용
4. ⏳ 스키마 변경 검증

**산출물**:
- `database/migration/001-add-work-days-field.sql`
- `database/migration/002-add-temporary-change-field.sql`
- `database/migration/003-create-schedule-changes-table.sql`

---

### Phase 2: 핵심 비즈니스 로직 개발 (2주)

**목표**: 4주 주기 반대 방향 순환 시스템 구현

**작업 내용**:
1. ⏳ 순환 계산 함수 구현
   - 4주 주기 반대 방향 순환 로직
   - `calculateOffDayByWeekCycle()` 함수
   
2. ⏳ 일시적 변경 시스템 구현
   - 변경 요청 API
   - 승인 워크플로우
   - 대체자 확인 로직

3. ⏳ 공휴일 처리 로직 구현
   - 공휴일 포함 주 감지
   - 반차 분할 제한

4. ⏳ 수습 기간 체크 로직 구현
   - 수습 기간 계산
   - 4일제/반차 제한

**산출물**:
- `routes/staff/work-schedules.js` (업데이트)
- 순환 계산 헬퍼 함수
- 공휴일 처리 헬퍼 함수

---

### Phase 3: API 개발 (1.5주)

**목표**: 새로운 운영 원칙을 반영한 API 구현

**작업 내용**:
1. ⏳ 스케줄 조회 API 업데이트
   - 4주 주기 순환 반영
   - 일시적 변경 정보 포함

2. ⏳ 일시적 변경 API 개발
   - `POST /api/staff/work-schedules/temporary-change` - 변경 요청
   - `GET /api/staff/work-schedules/pending-changes` - 승인 대기 목록
   - `POST /api/staff/work-schedules/approve-change/:changeId` - 승인/거부

3. ⏳ 반차 신청 API 업데이트
   - 같은 주 검증 로직 추가
   - 공휴일 포함 주 반차 분할 제한

4. ⏳ 순환 계산 API 개발
   - `GET /api/staff/work-schedules/calculate-off-day` - 휴무일 계산

**산출물**:
- API 엔드포인트 구현
- API 문서

---

### Phase 4: 프론트엔드 개발 (2주)

**목표**: 사용자 인터페이스 업데이트

**작업 내용**:
1. ⏳ 직원 스케줄 페이지 업데이트
   - 순환 설명 텍스트 변경
   - 4주 주기 정보 표시
   
2. ⏳ 일시적 변경 기능 UI
   - 변경 요청 모달
   - 승인 대기 목록 (팀장용)

3. ⏳ 반차 신청 UI 업데이트
   - 같은 주 검증 메시지
   - 공휴일 포함 주 안내

4. ⏳ 수습 기간 안내 추가
   - 수습 기간 중 제한 사항 표시

**산출물**:
- `employee-schedule.html` (업데이트)
- `employee-schedule.js` (업데이트)
- 새로운 모달 컴포넌트

---

### Phase 5: 통합 테스트 및 안정화 (1주)

**목표**: 전체 시스템 검증 및 버그 수정

**작업 내용**:
1. ⏳ 단위 테스트
2. ⏳ 통합 테스트
3. ⏳ 사용자 시나리오 테스트
4. ⏳ 성능 테스트
5. ⏳ 버그 수정

**산출물**:
- 테스트 리포트
- 버그 리스트 및 수정 내역

---

### Phase 6: 문서화 및 배포 (0.5주)

**목표**: 최종 문서화 및 프로덕션 배포

**작업 내용**:
1. ⏳ 사용자 가이드 작성
2. ⏳ 관리자 매뉴얼 작성
3. ⏳ 기술 문서 업데이트
4. ⏳ 프로덕션 배포

**산출물**:
- 사용자 가이드
- 관리자 매뉴얼
- 배포 가이드

---

## 2. 우선순위

### High Priority (필수)

1. **데이터베이스 마이그레이션** - 모든 기능의 기반
2. **순환 계산 로직** - 핵심 비즈니스 로직
3. **스케줄 조회 API** - 기본 기능
4. **직원 스케줄 페이지 업데이트** - 사용자 인터페이스

### Medium Priority (중요)

1. **일시적 변경 시스템** - 새로운 기능
2. **반차 시스템 업데이트** - 기존 기능 개선
3. **공휴일 처리** - 예외 상황 처리

### Low Priority (보완)

1. **수습 기간 체크** - 예외 상황 처리
2. **관리자 대시보드** - 관리 기능
3. **통계 및 리포트** - 분석 기능

---

## 3. 마이그레이션 계획

### 3.1 마이그레이션 스크립트 작성

**파일 위치**: `database/migration/`

**스크립트 목록**:
1. `001-add-work-days-field.sql` - users.work_days 필드 추가
2. `002-add-temporary-change-field.sql` - work_schedules.temporary_change 필드 추가
3. `003-create-schedule-changes-table.sql` - schedule_changes 테이블 생성

### 3.2 마이그레이션 순서

1. 백업 (현재 데이터 백업)
2. 개발 환경 테스트
3. 스테이징 환경 적용
4. 프로덕션 환경 적용

### 3.3 롤백 계획

각 마이그레이션에 대한 롤백 스크립트 준비

---

## 4. API 개발 계획

### 4.1 순환 계산 API

```
GET /api/staff/work-schedules/calculate-off-day
Query: ?date=2025-01-15
Response: { off_day: 2, off_day_name: "화요일", cycle_week: 1 }
```

### 4.2 일시적 변경 API

```
POST /api/staff/work-schedules/temporary-change
Body: { week_start_date, temporary_off_day, reason, substitute_employee }
Response: { change_id, status: "PENDING" }
```

### 4.3 승인 대기 목록 API

```
GET /api/staff/work-schedules/pending-changes
Response: [ { change_id, user_name, week_start_date, ... } ]
```

### 4.4 승인/거부 API

```
POST /api/staff/work-schedules/approve-change/:changeId
Body: { action: "approve" | "reject", notes }
Response: { success: true }
```

---

## 5. 프론트엔드 개발 계획

### 5.1 직원 스케줄 페이지 업데이트

**변경 사항**:
- 순환 설명: "5개월 주기" → "4주 주기"
- 순환 방향: 정방향 → 반대 방향
- 다음 주기 정보 표시

### 5.2 일시적 변경 기능 UI

**새로운 컴포넌트**:
- 변경 요청 모달
- 승인 대기 목록 페이지 (팀장용)
- 변경 이력 표시

### 5.3 반차 신청 UI 업데이트

**변경 사항**:
- 같은 주 검증 메시지
- 공휴일 포함 주 안내
- 주 초과 반차 이월 경고

---

## 6. 테스트 계획

### 6.1 단위 테스트

- 순환 계산 함수 테스트
- 공휴일 감지 함수 테스트
- 수습 기간 계산 함수 테스트

### 6.2 통합 테스트

- 스케줄 생성 플로우 테스트
- 일시적 변경 승인 플로우 테스트
- 반차 신청 플로우 테스트

### 6.3 사용자 시나리오 테스트

**시나리오 1**: 정상 순환
1. 초기 휴무일 선택
2. 4주 후 휴무일 변경 확인
3. 다음 4주 후 휴무일 변경 확인

**시나리오 2**: 일시적 변경
1. 변경 요청
2. 팀장 승인
3. 해당 주에만 적용 확인
4. 다음 주 원래 순환 복귀 확인

**시나리오 3**: 반차 신청
1. 같은 주 내 반차 신청 (성공)
2. 주 초과 반차 신청 시도 (실패)

**시나리오 4**: 공휴일 처리
1. 공휴일 포함 주에서 반차 분할 시도 (실패)
2. 공휴일 포함 주에서 추가 휴무일 없음 확인

---

## 7. 다음 단계 (즉시 시작 가능)

### 옵션 1: 마이그레이션 SQL 스크립트 작성

**작업 내용**:
- `database/migration/` 폴더 생성
- 3개의 마이그레이션 스크립트 작성
- 롤백 스크립트 작성

**예상 소요 시간**: 2-3시간

### 옵션 2: 순환 계산 함수 구현

**작업 내용**:
- `routes/staff/work-schedules.js`에 헬퍼 함수 추가
- 4주 주기 반대 방향 순환 로직 구현
- 테스트 코드 작성

**예상 소요 시간**: 4-6시간

### 옵션 3: API 엔드포인트 상세 설계

**작업 내용**:
- 각 API의 요청/응답 스펙 상세 작성
- 에러 코드 정의
- 권한 체크 규칙 정리

**예상 소요 시간**: 3-4시간

---

## 8. 예상 일정

| Phase | 작업 내용 | 예상 기간 | 시작일 | 완료일 |
|-------|----------|----------|--------|--------|
| Phase 1 | DB 마이그레이션 | 1주 | - | - |
| Phase 2 | 핵심 로직 개발 | 2주 | - | - |
| Phase 3 | API 개발 | 1.5주 | - | - |
| Phase 4 | 프론트엔드 개발 | 2주 | - | - |
| Phase 5 | 테스트 및 안정화 | 1주 | - | - |
| Phase 6 | 문서화 및 배포 | 0.5주 | - | - |
| **총계** | | **8주** | - | - |

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-01-XX

