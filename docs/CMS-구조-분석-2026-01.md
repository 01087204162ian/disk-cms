# disk-cms 구조 분석 보고서

**작성일**: 2026-01-XX  
**목적**: 현재 CMS 개발 상태를 구조적으로 분석하여 상품 관리, 업무(Ticket), 계약, 정산의 관계를 파악

---

## 📋 목차

1. [상품(Product) 위치 및 구조](#1-상품product-위치-및-구조)
2. [상품과 업무(Ticket)의 연결 관계](#2-상품과-업무ticket의-연결-관계)
3. [상품과 계약(Contract)의 연결 관계](#3-상품과-계약contract의-연결-관계)
4. [상품과 정산(Settlement)의 연결 관계](#4-상품과-정산settlement의-연결-관계)
5. [코드 관점 분석](#5-코드-관점-분석)
6. [구조 관점 분석](#6-구조-관점-분석)
7. [종합 평가 및 제안](#7-종합-평가-및-제안)

---

## 1. 상품(Product) 위치 및 구조

### 1.1 현재 상태

#### ✅ **정의는 있으나 사용되지 않음**

**데이터베이스 스키마** (`disk-cms/sql.txt`):
```sql
CREATE TABLE products (
  id int NOT NULL AUTO_INCREMENT,
  name varchar(100) NOT NULL COMMENT '상품명',
  code varchar(50) NOT NULL COMMENT '상품코드',
  category varchar(50) DEFAULT NULL COMMENT '상품 카테고리',
  description text COMMENT '상품 설명',
  is_active tinyint(1) DEFAULT '1',
  created_at timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY code (`code`)
)

CREATE TABLE product_managers (
  id int NOT NULL AUTO_INCREMENT,
  product_id int NOT NULL,
  user_id varchar(100) DEFAULT NULL,
  manager_type enum('PRIMARY','SECONDARY') DEFAULT 'PRIMARY' COMMENT '정/부 담당자',
  ...
)
```

**문제점**:
- ❌ `products` 테이블은 정의되어 있으나 **실제 코드에서 사용되지 않음**
- ❌ 라우터(`routes/`)에 상품 관련 API 없음
- ❌ 프론트엔드(`public/pages/`)에 상품 관리 페이지 없음
- ❌ 서비스(`services/`)에 상품 관련 서비스 없음

#### ✅ **실제 상품은 각 하위 폴더에 분산**

**현재 상품 구조** (메뉴 기반):
```
보험상품 (insurance)
├─ 대리운전 (proxy-driving)
│   ├─ KJ대리운전 → pci0327/api/insurance/*
│   ├─ daS대리운전 → (미구현)
│   └─ 개인대리운전 → (미구현)
├─ 현장실습보험 (internship) → fstudent/api/*
├─ 약국배상책임보험 (pharmacy) → imet/api/pharmacy/*
├─ 홀인원보험 (hole-in-one) → pci0327/api/holeinone/*
└─ 여행자보험 (travel) → (미구현)
```

**특징**:
- 각 상품은 **독립된 백엔드 서비스** (PHP)
- 각 상품은 **독립된 도메인** (imet.kr, pcikorea.com 등)
- 각 상품은 **독립된 데이터베이스 테이블**
- 상품 간 공통 관리 체계 없음

### 1.2 상품 관리 방식

#### **현재 방식: 메뉴 중심 관리**

**위치**: `disk-cms/public/config/menu-config.json`

```json
{
  "id": "insurance",
  "title": "보험상품",
  "children": [
    {
      "id": "pharmacy",
      "title": "약국배상책임보험",
      "children": [
        {
          "id": "pharmacy-applications",
          "page": "insurance/pharmacy-applications"
        }
      ]
    }
  ]
}
```

**특징**:
- ✅ 메뉴 구조로 상품 계층 정의
- ❌ 데이터베이스에 상품 정보 저장 안 함
- ❌ 상품 코드/카테고리 관리 없음
- ❌ 상품별 담당자 관리 없음

---

## 2. 상품과 업무(Ticket)의 연결 관계

### 2.1 현재 상태

#### ❌ **연결 관계 없음**

**티켓 스키마** (`docs/보험운영플랫폼/schema_v1.sql`):
```sql
CREATE TABLE tickets (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ticket_number VARCHAR(50) NOT NULL UNIQUE,
  ticket_type_code VARCHAR(50) NOT NULL,  -- SETTLE, CLAIM, ACCIDENT 등
  contract_id INT NULL,                    -- 계약과 연결 (NULL 허용)
  title VARCHAR(255) NOT NULL,
  status ENUM('NEW','ASSIGNED','IN_PROGRESS','REVIEW','DONE','ARCHIVED'),
  ...
  -- ❌ product_id 컬럼 없음
  -- ❌ 상품과의 직접 연결 없음
)
```

**티켓 유형** (`docs/보험운영플랫폼/types-guide_content.txt`):
```
1. 리서치 (RESEARCH)
2. 프로젝트 (PROJECT)
3. 계약 (CONTRACT)
4. 정산 (SETTLEMENT)
5. 실적 (PERFORMANCE)
6. 민원 (CLAIM)
7. 사고 (ACCIDENT)
8. 제휴 (PARTNER)
9. 기타 (OTHER)
```

**문제점**:
- ❌ 티켓에 `product_id` 컬럼 없음
- ❌ 티켓은 계약(`contract_id`)과만 연결
- ❌ 상품별 티켓 필터링 불가
- ❌ 상품별 업무 현황 파악 어려움

### 2.2 간접 연결 경로

**현재 가능한 간접 연결**:
```
Ticket → Contract → (상품 정보 없음)
```

**실제 코드** (`services/ticketService.js`):
```javascript
// 티켓 조회 시 계약 정보는 JOIN하지만, 상품 정보는 없음
LEFT JOIN contracts c ON t.contract_id = c.id
LEFT JOIN partners p ON c.partner_id = p.id
LEFT JOIN customers cust ON c.customer_id = cust.id
// ❌ products 테이블 JOIN 없음
```

---

## 3. 상품과 계약(Contract)의 연결 관계

### 3.1 현재 상태

#### ❌ **연결 관계 없음**

**계약 스키마** (`docs/보험운영플랫폼/schema_v1.sql`):
```sql
CREATE TABLE contracts (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  contract_number VARCHAR(50) NOT NULL UNIQUE,
  partner_id INT NOT NULL,          -- 보험사
  customer_id INT NOT NULL,         -- 고객
  policy_number VARCHAR(100) NULL,  -- 증권번호
  contract_type VARCHAR(50) NULL,   -- 계약 유형 (일반 텍스트)
  start_date DATE NULL,
  end_date DATE NULL,
  premium_amount DECIMAL(15,2) NOT NULL DEFAULT 0.00,
  status ENUM('ACTIVE','SUSPENDED','TERMINATED','EXPIRED'),
  ...
  -- ❌ product_id 컬럼 없음
  -- ❌ 상품과의 직접 연결 없음
)
```

**문제점**:
- ❌ 계약에 `product_id` 컬럼 없음
- ❌ 계약 유형(`contract_type`)은 텍스트 필드 (상품 코드 아님)
- ❌ 상품별 계약 현황 파악 어려움
- ❌ 상품별 통계/분석 불가

### 3.2 실제 상품별 계약 관리

**현재 방식: 각 상품별 독립 테이블**

예시: 약국배상책임보험 (`imet` 데이터베이스):
```sql
-- 약국 계약 정보는 pharmacyApply 테이블에 저장
CREATE TABLE pharmacyApply (
  num int NOT NULL AUTO_INCREMENT,
  company varchar(50) NOT NULL COMMENT '상호',
  school2 varchar(15) NOT NULL COMMENT '사업자번호',
  sigi date NOT NULL COMMENT '보험시기',
  jeonggi date NOT NULL COMMENT '보험종기',
  ch char(2) NOT NULL DEFAULT '1' COMMENT '진행상태',
  proPreminum varchar(20) NOT NULL COMMENT '전문인보험료',
  areaPreminum varchar(20) NOT NULL COMMENT '화재보험료',
  ...
  -- ❌ product_id 없음 (약국배상 상품임이 테이블 자체로 암시)
)
```

**특징**:
- 각 상품은 **자체 테이블 구조** 사용
- 상품별로 **다른 필드 구조**
- 공통 계약 관리 체계 없음

---

## 4. 상품과 정산(Settlement)의 연결 관계

### 4.1 현재 상태

#### ❌ **연결 관계 없음** (보험 운영 플랫폼 기준)

**정산 스키마**: 보험 운영 플랫폼에는 정산 테이블이 없음

**실제 정산 관리**: 각 상품별 독립 테이블

#### ✅ **각 상품별 정산 테이블**

**약국배상책임보험 정산** (`imet` 데이터베이스):
```sql
-- pharmacy_settlementList: 약국 정산 기록
CREATE TABLE pharmacy_settlementList (
  applyNum int NOT NULL,           -- pharmacyApply.num 참조
  sort varchar(20),                 -- 상태 코드
  approvalPreminum varchar(20),     -- 승인 보험료
  proPreminum varchar(20),          -- 전문인 보험료
  areaPreminum varchar(20),         -- 화재 보험료
  wdate datetime,                   -- 처리일
  account varchar(10),              -- 거래처 코드
  ...
)
```

**KJ 대리운전 정산** (`pci0327` 데이터베이스):
```sql
-- AdjustmentPremium: 대리운전 정산 기록
CREATE TABLE AdjustmentPremium (
  dNum int,                         -- 대리운전회사 번호
  seqNo int,                        -- 정산 번호
  get char(1),                      -- 정산 상태 (1: 정산, 2: 미정산)
  manager varchar(20),              -- 담당자
  ...
)
```

**특징**:
- 각 상품마다 **다른 정산 테이블 구조**
- 정산 방식도 상품별로 다름
- 공통 정산 관리 체계 없음

---

## 5. 코드 관점 분석

### 5.1 데이터베이스 스키마

#### ✅ **정의만 있고 사용 안 됨**

| 테이블 | 상태 | 사용 여부 | 비고 |
|--------|------|----------|------|
| `products` | 정의됨 | ❌ 미사용 | `sql.txt`에만 존재 |
| `product_managers` | 정의됨 | ❌ 미사용 | `sql.txt`에만 존재 |
| `contracts` | 정의됨 | ✅ 사용 중 | 보험 운영 플랫폼 |
| `tickets` | 정의됨 | ✅ 사용 중 | 보험 운영 플랫폼 |
| `partners` | 정의됨 | ✅ 사용 중 | 보험 운영 플랫폼 |

**분석**:
- `products` 테이블은 **레거시 설계**로 보임
- 현재는 **각 상품이 독립 서비스**로 운영
- 보험 운영 플랫폼(`schema_v1.sql`)에는 `products` 테이블 없음

### 5.2 API 라우터

#### ❌ **상품 관리 API 없음**

**현재 라우터 구조**:
```
routes/
├─ pharmacy/          ✅ 약국배상 프록시
├─ insurance/         ✅ 대리운전 프록시
├─ tickets.js         ✅ 티켓 관리
├─ approvals.js       ✅ 승인 관리
└─ products.js        ❌ 없음
```

**분석**:
- 상품별 프록시는 있으나, **상품 자체를 관리하는 API 없음**
- 상품 정보는 **메뉴 설정 파일**에만 존재

### 5.3 프론트엔드 페이지

#### ❌ **상품 관리 페이지 없음**

**현재 페이지 구조**:
```
public/pages/
├─ pharmacy/          ✅ 약국배상 관리 페이지
├─ insurance/         ✅ 대리운전 관리 페이지
├─ tickets/           ✅ 티켓 관리 페이지
└─ products/          ❌ 없음
```

**분석**:
- 각 상품별 관리 페이지는 있으나, **상품 자체를 관리하는 페이지 없음**

### 5.4 서비스 레이어

#### ❌ **상품 서비스 없음**

**현재 서비스 구조**:
```
services/
├─ ticketService.js   ✅ 티켓 서비스
├─ authService.js     ✅ 인증 서비스
├─ userService.js     ✅ 사용자 서비스
└─ productService.js  ❌ 없음
```

---

## 6. 구조 관점 분석

### 6.1 기준 데이터인지, 단순 설정 화면인지

#### **현재: 단순 설정 화면 (메뉴 기반)**

**판단 기준**:
- ✅ **단순 설정 화면**: 메뉴 설정 파일(`menu-config.json`)에만 정의
- ❌ **기준 데이터 아님**: 데이터베이스에 저장 안 됨
- ❌ **관리 기능 없음**: CRUD API 없음
- ❌ **이력 관리 없음**: 상품 변경 이력 추적 안 됨

**특징**:
- 상품 추가/삭제 시 **코드 수정 필요** (메뉴 설정 파일)
- 상품 정보 변경 시 **재배포 필요**
- 상품별 담당자 관리 안 됨
- 상품별 권한 관리 안 됨

### 6.2 책임/이력/정산을 담보할 수 있는 구조인지

#### ❌ **현재 구조로는 담보 어려움**

**문제점**:

1. **책임(Responsibility) 관리**:
   - ❌ 상품별 담당자(`product_managers`) 테이블은 있으나 사용 안 됨
   - ❌ 티켓/계약에 상품 정보 없어서 상품별 책임 추적 불가
   - ❌ 상품별 업무 할당 불가

2. **이력(History) 관리**:
   - ❌ 상품 변경 이력 추적 불가 (메뉴 설정 파일만 수정)
   - ❌ 계약/티켓에 상품 정보 없어서 상품별 이력 조회 불가
   - ❌ 상품별 통계/분석 불가

3. **정산(Settlement) 관리**:
   - ❌ 공통 정산 관리 체계 없음
   - ❌ 각 상품별 독립 정산 테이블
   - ❌ 상품별 정산 현황 통합 조회 불가
   - ❌ 상품별 정산 기준 관리 불가

### 6.3 확장성 평가

#### **현재 구조의 한계**

**확장성 문제**:

1. **신규 상품 추가**:
   - ❌ 메뉴 설정 파일 수정 + 재배포 필요
   - ❌ 상품별 독립 백엔드 서비스 구축 필요
   - ❌ 공통 관리 체계 활용 불가

2. **상품별 기능 확장**:
   - ❌ 상품별 맞춤 기능 추가 어려움
   - ❌ 상품별 권한/담당자 관리 어려움
   - ❌ 상품별 통계/분석 기능 추가 어려움

3. **통합 관리**:
   - ❌ 전체 상품 현황 통합 조회 불가
   - ❌ 상품별 비교 분석 불가
   - ❌ 상품별 실적 통합 관리 불가

---

## 7. 종합 평가 및 제안

### 7.1 현재 상태 요약

| 항목 | 상태 | 평가 |
|------|------|------|
| **상품 위치** | 메뉴 설정 파일 | ❌ 기준 데이터 아님 |
| **상품-Ticket 연결** | 없음 | ❌ 연결 필요 |
| **상품-Contract 연결** | 없음 | ❌ 연결 필요 |
| **상품-정산 연결** | 없음 (각 상품별 독립) | ❌ 통합 필요 |
| **책임 관리** | 불가 | ❌ 기능 추가 필요 |
| **이력 관리** | 불가 | ❌ 기능 추가 필요 |
| **정산 통합** | 불가 | ❌ 구조 개선 필요 |
| **확장성** | 낮음 | ❌ 구조 개선 필요 |

### 7.2 제안사항

#### **Option A: 점진적 개선 (추천)**

**1단계: 상품 기준 데이터화**
- `products` 테이블 활성화 (이미 정의됨)
- 상품 관리 API/페이지 추가
- 메뉴 설정 파일과 동기화

**2단계: 계약-상품 연결**
- `contracts` 테이블에 `product_id` 추가
- 기존 계약 데이터 마이그레이션
- 계약 생성/조회 시 상품 정보 포함

**3단계: 티켓-상품 연결**
- `tickets` 테이블에 `product_id` 추가 (직접 또는 계약을 통해)
- 티켓 생성/조회 시 상품 정보 포함
- 상품별 티켓 필터링 기능

**4단계: 정산 통합**
- 공통 정산 테이블 설계 (상품별 확장 필드)
- 각 상품별 정산 데이터 마이그레이션
- 통합 정산 조회 API

**장점**:
- ✅ 기존 시스템과 호환
- ✅ 단계별 적용 가능
- ✅ 리스크 낮음

#### **Option B: 전면 재설계 (대규모 변경)**

**새로운 구조**:
```
Products (기준 데이터)
  ↓ (1:N)
Contracts (상품 포함)
  ↓ (1:N)
Tickets (상품 포함)
  ↓ (1:N)
Settlements (통합 정산)
```

**장점**:
- ✅ 명확한 구조
- ✅ 확장성 높음
- ✅ 통합 관리 가능

**단점**:
- ❌ 대규모 변경 필요
- ❌ 기존 데이터 마이그레이션 필요
- ❌ 리스크 높음

### 7.3 권장 방향

#### **즉시 적용 가능한 개선**

1. **상품 기준 데이터화** (우선순위: 높음)
   - `products` 테이블 활성화
   - 상품 관리 API/페이지 추가
   - 기존 메뉴 설정과 연동

2. **계약-상품 연결** (우선순위: 중간)
   - `contracts.product_id` 추가
   - 기존 계약 데이터에 상품 정보 추가
   - 신규 계약 생성 시 상품 필수

3. **티켓-상품 연결** (우선순위: 중간)
   - 티켓 생성 시 계약을 통해 상품 자동 연결
   - 상품별 티켓 필터링 기능

4. **정산 통합** (우선순위: 낮음)
   - 장기 계획으로 설계
   - 각 상품별 정산 구조 분석 후 통합 방안 수립

---

## 8. 결론

### 현재 상태

- **상품 관리**: 메뉴 설정 파일 기반 (단순 설정)
- **상품-Ticket 연결**: 없음
- **상품-Contract 연결**: 없음
- **상품-정산 연결**: 없음 (각 상품별 독립)

### 평가

- **기준 데이터 여부**: ❌ 단순 설정 화면
- **책임/이력/정산 담보 가능 여부**: ❌ 현재 구조로는 어려움

### 권장사항

**Option A (점진적 개선)**를 추천합니다:
1. 상품 기준 데이터화 (즉시)
2. 계약-상품 연결 (단기)
3. 티켓-상품 연결 (단기)
4. 정산 통합 (장기)

이를 통해 기존 시스템과의 호환성을 유지하면서 점진적으로 구조를 개선할 수 있습니다.

