<!-- 현대화된 헤더 - Tabler 기반 -->
<div class="page-header d-print-none">
  <div class="container-xl">
    <div class="row g-2 align-items-center">
      <div class="col">
        <!-- 브레드크럼 -->
        <div class="page-pretitle" id="pagePretitle" style="display: none;">
          브레드크럼
        </div>
        <h2 class="page-title" id="pageTitle">
          페이지 제목
        </h2>
      </div>
      <div class="col-auto ms-auto d-print-none">
        <div class="btn-list">
          <!-- 현재 시간 -->
          <span class="badge bg-blue-lt" id="currentTime">
            --:--:--
          </span>
          
          <!-- 알림 -->
          <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M10 5a2 2 0 0 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6"/>
                <path d="M9 17v1a3 3 0 0 0 6 0v-1"/>
              </svg>
              <span class="badge bg-red" id="notificationCount" style="display: none;">0</span>
            </button>
            <div class="dropdown-menu dropdown-menu-end">
              <h6 class="dropdown-header">알림</h6>
              <div id="notificationList">
                <div class="dropdown-item text-muted">새로운 알림이 없습니다.</div>
              </div>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item dropdown-footer text-center">모든 알림 보기</a>
            </div>
          </div>

          <!-- 사용자 메뉴 -->
          <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              <img data-user-image src="https://ui-avatars.com/api/?name=User&background=0d6efd&color=fff" class="avatar avatar-sm me-2" alt="">
              <span data-user-name>사용자</span>
            </button>
            <div class="dropdown-menu dropdown-menu-end">
              <div class="dropdown-item-text">
                <div class="d-flex align-items-center">
                  <img data-user-image src="https://ui-avatars.com/api/?name=User&background=0d6efd&color=fff" class="avatar me-3" alt="">
                  <div>
                    <div class="fw-bold" data-user-name>사용자</div>
                    <div class="text-muted small" data-user-role>직원</div>
                    <div class="text-muted small" data-user-email>user@example.com</div>
                  </div>
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <circle cx="12" cy="12" r="9"/>
                  <circle cx="12" cy="10" r="3"/>
                  <path d="M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855"/>
                </svg>
                프로필
              </a>
              <a href="#" class="dropdown-item">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                설정
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item text-danger" onclick="logout()">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"/>
                  <path d="M7 12h14l-3 -3m0 6l3 -3"/>
                </svg>
                로그아웃
              </a>
            </div>
          </div>
          
          <!-- 전체화면 토글 -->
          <button class="btn btn-outline-secondary" type="button" onclick="toggleFullscreen()" title="전체화면 토글">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M4 8v-2a2 2 0 0 1 2 -2h2"/>
              <path d="M4 16v2a2 2 0 0 0 2 2h2"/>
              <path d="M16 4h2a2 2 0 0 1 2 2v2"/>
              <path d="M16 20h2a2 2 0 0 0 2 -2v-2"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/**
 * 전역 로그아웃 함수
 */
async function logout() {
  if (window.modernTemplateLoader) {
    await window.modernTemplateLoader.logout();
  } else {
    // 백업: 직접 로그아웃 처리
    if (confirm('로그아웃 하시겠습니까?')) {
      window.location.href = '/login.html';
    }
  }
}

/**
 * 전체화면 토글 함수
 */
function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.log('전체화면 모드로 전환할 수 없습니다:', err);
    });
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
}

/**
 * 알림 업데이트 함수
 */
function updateHeaderNotifications(notifications = []) {
  const countElement = document.getElementById('notificationCount');
  const listElement = document.getElementById('notificationList');

  if (countElement) {
    countElement.textContent = notifications.length;
    countElement.style.display = notifications.length > 0 ? '' : 'none';
  }

  if (listElement) {
    if (notifications.length === 0) {
      listElement.innerHTML = '<div class="dropdown-item text-muted">새로운 알림이 없습니다.</div>';
    } else {
      listElement.innerHTML = notifications.map(notification => `
        <div class="dropdown-item">
          <div class="d-flex">
            <div class="flex-fill">
              <div class="fw-semibold">${notification.title || '알림'}</div>
              <div class="text-muted small">${notification.message || ''}</div>
              <div class="text-muted smaller">${formatNotificationTime(notification.created_at)}</div>
            </div>
            ${!notification.read ? '<span class="badge bg-red ms-2"></span>' : ''}
          </div>
        </div>
      `).join('');
    }
  }
}

/**
 * 알림 시간 포맷팅
 */
function formatNotificationTime(dateString) {
  if (!dateString) return '';
  
  const date = new Date(dateString);
  const now = new Date();
  const diffMs = now - date;
  const diffMinutes = Math.floor(diffMs / (1000 * 60));
  const diffHours = Math.floor(diffMinutes / 60);
  const diffDays = Math.floor(diffHours / 24);

  if (diffMinutes < 1) return '방금 전';
  if (diffMinutes < 60) return `${diffMinutes}분 전`;
  if (diffHours < 24) return `${diffHours}시간 전`;
  if (diffDays < 7) return `${diffDays}일 전`;
  
  return date.toLocaleDateString('ko-KR');
}