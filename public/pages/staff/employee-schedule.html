<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>보험 CMS | 근무일정</title>
  
  <!-- 한글 폰트 (Google Fonts) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/sj-styles.css" rel="stylesheet">
  <link href="/css/employee-schedule.css" rel="stylesheet">
</head>
<body>
  <!-- 로딩 오버레이 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading">
      <i class="fas fa-spinner"></i>
      <div>페이지를 불러오는 중...</div>
    </div>
  </div>
  
  <!-- 헤더 컨테이너 -->
  <div id="header-container">
    <!-- sj-header.html 컴포넌트가 여기에 로드됩니다 -->
  </div>
  
  <!-- 사이드바 오버레이 (모바일용) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  
  <!-- 사이드바 컨테이너 -->
  <div id="sidebar-container">
    <!-- sj-sidebar.html 컴포넌트가 여기에 로드됩니다 -->
  </div>
  
  <!-- 메인 컨텐츠 -->
  <main class="main-content">
    <div class="container-fluid">
      <!-- 메인 레이아웃: 1/3 정보/버튼 + 2/3 캘린더 -->
      <div class="row g-3">
        <!-- 왼쪽: 정보 및 버튼 영역 (1/3) -->
        <div class="col-lg-4 col-md-12">
          <div class="sticky-sidebar">
            <!-- 알림 영역 -->
            <div id="noticeArea" class="mb-3">
              <!-- 수습 기간 알림 -->
              <div class="alert alert-info probation-notice d-flex align-items-center" id="probationNotice" style="display: none;">
                <i class="fas fa-info-circle me-2"></i>
                <div class="small">
                  <strong>수습 기간 중입니다.</strong> 주 4일 근무제는 입사 후 3개월 경과 후 적용됩니다.
                </div>
              </div>
              
              <!-- 공휴일 포함 주 알림 -->
              <div class="alert alert-warning holiday-notice d-flex align-items-center" id="holidayNotice" style="display: none;">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <div class="small">
                  <strong>공휴일 포함 주입니다.</strong> 이번 주는 주 4일 근무가 적용되지 않습니다.
                </div>
              </div>
            </div>

            <!-- 빠른 작업 버튼 -->
            <div class="card mb-3">
              <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                  <i class="fas fa-bolt me-2"></i>빠른 작업
                </h6>
              </div>
              <div class="card-body">
                <button class="btn btn-success w-100 mb-2" id="halfDayBtn">
                  <i class="fas fa-clock me-2"></i>반차 신청
                </button>
                <button class="btn btn-info w-100" id="temporaryChangeBtn">
                  <i class="fas fa-exchange-alt me-2"></i>휴무일 변경
                </button>
              </div>
            </div>

            <!-- 근무 패턴 정보 -->
            <div class="card mb-3">
              <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                  <i class="fas fa-info-circle me-2"></i>근무 패턴
                </h6>
              </div>
              <div class="card-body">
                <div class="info-item-compact mb-3">
                  <div class="info-label-compact">
                    <i class="fas fa-calendar-times me-2 text-danger"></i>기본 휴무일
                  </div>
                  <div class="info-value-compact fw-bold text-danger" id="baseOffDayDisplay">-</div>
                </div>
                
                <div class="info-item-compact mb-3">
                  <div class="info-label-compact">
                    <i class="fas fa-sync-alt me-2 text-primary"></i>사이클 정보
                  </div>
                  <div class="info-value-compact">
                    <span class="badge bg-primary" id="cycleInfoBadge">-</span>
                  </div>
                </div>
                
                <div class="info-item-compact mb-3">
                  <div class="info-label-compact">
                    <i class="fas fa-calendar-week me-2 text-info"></i>이번 달 패턴
                  </div>
                  <div class="info-value-compact fw-bold text-info small" id="currentPatternDisplay">-</div>
                </div>
                
                <div class="info-item-compact">
                  <div class="info-label-compact">
                    <i class="fas fa-arrow-right me-2 text-success"></i>다음 사이클
                  </div>
                  <div class="info-value-compact text-success small" id="nextCycleDisplay">-</div>
                </div>
              </div>
            </div>

            <!-- 통계 정보 -->
            <div class="card">
              <div class="card-header bg-success text-white">
                <h6 class="mb-0">
                  <i class="fas fa-chart-pie me-2"></i>이번 달 통계
                </h6>
              </div>
              <div class="card-body">
                <div class="stat-item-compact mb-3">
                  <div class="stat-label-compact text-muted">근무일</div>
                  <div class="stat-value-compact fw-bold text-success" id="workDaysCount">-</div>
                </div>
                <div class="stat-item-compact mb-3">
                  <div class="stat-label-compact text-muted">휴무일</div>
                  <div class="stat-value-compact fw-bold text-danger" id="offDaysCount">-</div>
                </div>
                <div class="stat-item-compact">
                  <div class="stat-label-compact text-muted">총 근무시간</div>
                  <div class="stat-value-compact fw-bold text-primary" id="totalHours">-</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 오른쪽: 캘린더 영역 (2/3) -->
        <div class="col-lg-8 col-md-12">
          <!-- 캘린더 영역 -->
          <div class="card h-100">
            <div class="card-header bg-light">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <h5 class="mb-0">
                  <i class="fas fa-calendar-alt me-2"></i>
                  <span id="currentMonthDisplay">2025년 12월</span>
                </h5>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <button class="btn btn-outline-primary btn-sm" id="prevMonthBtn">
                    <i class="fas fa-chevron-left"></i> <span class="d-none d-sm-inline">이전</span>
                  </button>
                  <div class="month-selector d-flex align-items-center gap-2">
                    <select class="form-control form-control-sm" id="yearSelect" style="width: 90px;">
                      <!-- 연도 옵션은 JavaScript에서 동적으로 생성 -->
                    </select>
                    <span class="small">년</span>
                    <select class="form-control form-control-sm" id="monthSelect" style="width: 100px;">
                      <option value="1">1월</option>
                      <option value="2">2월</option>
                      <option value="3">3월</option>
                      <option value="4">4월</option>
                      <option value="5">5월</option>
                      <option value="6">6월</option>
                      <option value="7">7월</option>
                      <option value="8">8월</option>
                      <option value="9">9월</option>
                      <option value="10">10월</option>
                      <option value="11">11월</option>
                      <option value="12">12월</option>
                    </select>
                  </div>
                  <button class="btn btn-outline-primary btn-sm" id="nextMonthBtn">
                    <span class="d-none d-sm-inline">다음</span> <i class="fas fa-chevron-right"></i>
                  </button>
                  <button class="btn btn-primary btn-sm" id="todayBtn">
                    <i class="fas fa-calendar-day me-1"></i><span class="d-none d-sm-inline">오늘</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body p-2 p-md-3">
              <div id="calendarContainer">
                <!-- 캘린더는 JavaScript에서 동적으로 생성 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- 기본 휴무일 설정 모달 (처음 설정 시) -->
  <div class="modal fade" id="setWorkDaysModal" tabindex="-1" aria-labelledby="setWorkDaysModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="setWorkDaysModalLabel">
            <i class="fas fa-calendar-check me-2"></i>기본 휴무일 설정
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-3">주 4일 근무제를 시작하기 위해 기본 휴무일을 선택해주세요.</p>
          <p class="text-muted small mb-3">선택한 요일이 4주 동안 고정 휴무일이 됩니다.</p>
          <div class="form-group">
            <label class="form-label fw-bold">기본 휴무일 선택</label>
            <div class="btn-group-vertical w-100" role="group">
              <input type="radio" class="btn-check" name="baseOffDay" id="offDay1" value="1" checked>
              <label class="btn btn-outline-primary" for="offDay1">
                <i class="fas fa-calendar-day me-2"></i>월요일
              </label>
              
              <input type="radio" class="btn-check" name="baseOffDay" id="offDay2" value="2">
              <label class="btn btn-outline-primary" for="offDay2">
                <i class="fas fa-calendar-day me-2"></i>화요일
              </label>
              
              <input type="radio" class="btn-check" name="baseOffDay" id="offDay3" value="3">
              <label class="btn btn-outline-primary" for="offDay3">
                <i class="fas fa-calendar-day me-2"></i>수요일
              </label>
              
              <input type="radio" class="btn-check" name="baseOffDay" id="offDay4" value="4">
              <label class="btn btn-outline-primary" for="offDay4">
                <i class="fas fa-calendar-day me-2"></i>목요일
              </label>
              
              <input type="radio" class="btn-check" name="baseOffDay" id="offDay5" value="5">
              <label class="btn btn-outline-primary" for="offDay5">
                <i class="fas fa-calendar-day me-2"></i>금요일
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="button" class="btn btn-primary" id="confirmSetWorkDaysBtn">
            <i class="fas fa-check me-2"></i>설정 완료
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 반차 신청 모달 -->
  <div class="modal fade" id="halfDayModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-clock me-2"></i>
            반차 신청
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">신청 날짜</label>
            <input type="date" class="form-control" id="halfDayDate" required>
            <small class="form-text text-muted">같은 주(월~일) 내에서만 사용 가능합니다.</small>
          </div>
          
          <div class="mb-3">
            <label class="form-label">반차 타입</label>
            <select class="form-select" id="halfDayType" required>
              <option value="">선택하세요</option>
              <option value="HALF_AM">오전 반차 (14시 출근)</option>
              <option value="HALF_PM">오후 반차 (14시 퇴근)</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">사유</label>
            <textarea class="form-control" id="halfDayReason" rows="3" required></textarea>
          </div>
          
          <!-- 검증 메시지 영역 -->
          <div class="alert alert-warning half-day-validation" id="halfDayValidation" style="display: none;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span id="halfDayValidationMessage"></span>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="button" class="btn btn-primary" id="submitHalfDayBtn">신청하기</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 일시적 변경 모달 -->
  <div class="modal fade" id="temporaryChangeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-exchange-alt me-2"></i>
            휴무일 일시적 변경
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">변경할 주 시작일 (월요일)</label>
            <input type="date" class="form-control" id="weekStartDate" readonly>
            <small class="form-text text-muted">해당 주의 월요일이 자동으로 설정됩니다.</small>
          </div>
          
          <div class="mb-3">
            <label class="form-label">원래 휴무일</label>
            <input type="text" class="form-control" id="originalOffDay" readonly>
          </div>
          
          <div class="mb-3">
            <label class="form-label">임시 휴무일</label>
            <select class="form-select" id="temporaryOffDay" required>
              <option value="">선택하세요</option>
              <option value="1">월요일</option>
              <option value="2">화요일</option>
              <option value="3">수요일</option>
              <option value="4">목요일</option>
              <option value="5">금요일</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">대체 직원 (선택사항)</label>
            <input type="email" class="form-control" id="substituteEmployee" placeholder="이메일 주소">
          </div>
          
          <div class="mb-3">
            <label class="form-label">변경 사유</label>
            <textarea class="form-control" id="temporaryChangeReason" rows="3" required></textarea>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="button" class="btn btn-primary" id="submitTemporaryChangeBtn">신청하기</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- SJ Template Loader -->
  <script src="/js/sj-template-loader.js"></script>
  
  <script>
    // 페이지 로드 후 자동 초기화
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('근무일정 페이지가 로드되었습니다.');
      
      // employee-schedule은 사이드바의 data-menu 값과 일치
      await window.sjTemplateLoader.initializePage('employee-schedule');
    });
  </script>
  
  <!-- Employee Schedule JS -->
  <script src="/js/staff/employee-schedule.js"></script>
</body>
</html>
