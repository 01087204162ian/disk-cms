<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>보험 CMS | 대시보드</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- AdminLTE CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/3.2.0/css/adminlte.min.css">
  
  <link rel="stylesheet" href="../css/dashboard.css">
</head>

<body class="hold-transition sidebar-mini layout-fixed">
  <div class="wrapper">
    
    <!-- Preloader -->
    <div class="preloader flex-column justify-content-center align-items-center">
      <img class="animation__shake" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjNjY3ZWVhIi8+Cjwvc3ZnPgo=" alt="AdminLTELogo" height="60" width="60">
    </div>

    <!-- 템플릿 컨테이너들 -->
    <div id="header-container"></div>
    <div id="sidebar-container"></div>

    <!-- 대시보드만의 고유한 콘텐츠 -->
    <div class="content-wrapper">
      <!-- Content Header -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <!-- 헤더는 간소화 -->
          </div>
        </div>
      </div>

      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          
          <!-- 출퇴근 카드 -->
          <div class="row">
            <div class="col-12">
              <div class="card attendance-card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i class="fas fa-clock mr-2"></i>
                    출퇴근 관리
                  </h3>
                  <div class="card-tools">
                    <span class="current-time" id="cardCurrentTime"></span>
                  </div>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="row">
                        <div class="col-sm-6 mb-2">
                          <button class="btn attendance-btn btn-block" id="checkinBtn" onclick="checkIn()">
                            <i class="fas fa-sign-in-alt mr-2"></i>
                            출근하기
                          </button>
                        </div>
                        <div class="col-sm-6 mb-2">
                          <button class="btn attendance-btn btn-block" id="checkoutBtn" onclick="checkOut()" disabled>
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            퇴근하기
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="row">
                        <div class="col-4">
                          <div class="status-item">
                            <div class="status-label">출근시간</div>
                            <div class="status-value" id="checkinTime">--:--</div>
                          </div>
                        </div>
                        <div class="col-4">
                          <div class="status-item">
                            <div class="status-label">퇴근시간</div>
                            <div class="status-value" id="checkoutTime">--:--</div>
                          </div>
                        </div>
                        <div class="col-4">
                          <div class="status-item">
                            <div class="status-label">근무시간</div>
                            <div class="status-value" id="workHours">0.0h</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 개인 통계 카드 -->
          <div class="row">
            <div class="col-lg-3 col-6">
              <div class="small-box bg-info">
                <div class="inner">
                  <h3 id="monthlyStats">
                    <div class="loading-spinner"></div>
                  </h3>
                  <p>이번 달 처리 건수</p>
                </div>
                <div class="icon">
                  <i class="fas fa-tasks"></i>
                </div>
                <a href="#" class="small-box-footer">
                  더보기 <i class="fas fa-arrow-circle-right"></i>
                </a>
              </div>
            </div>

            <div class="col-lg-3 col-6">
              <div class="small-box bg-success">
                <div class="inner">
                  <h3 id="avgProcessingTime">
                    <div class="loading-spinner"></div>
                  </h3>
                  <p>평균 처리시간 (분)</p>
                </div>
                <div class="icon">
                  <i class="fas fa-clock"></i>
                </div>
                <a href="#" class="small-box-footer">
                  더보기 <i class="fas fa-arrow-circle-right"></i>
                </a>
              </div>
            </div>

            <div class="col-lg-3 col-6">
              <div class="small-box bg-warning">
                <div class="inner">
                  <h3 id="weeklyHours">
                    <div class="loading-spinner"></div>
                  </h3>
                  <p>이번 주 근무시간</p>
                </div>
                <div class="icon">
                  <i class="fas fa-calendar-week"></i>
                </div>
                <a href="#" class="small-box-footer">
                  더보기 <i class="fas fa-arrow-circle-right"></i>
                </a>
              </div>
            </div>

            <div class="col-lg-3 col-6">
              <div class="small-box bg-danger">
                <div class="inner">
                  <h3 id="achievementRate">
                    <div class="loading-spinner"></div>
                  </h3>
                  <p>목표 달성률 (%)</p>
                </div>
                <div class="icon">
                  <i class="fas fa-trophy"></i>
                </div>
                <a href="#" class="small-box-footer">
                  더보기 <i class="fas fa-arrow-circle-right"></i>
                </a>
              </div>
            </div>
          </div>

          <!-- 관리자 전용 섹션 -->
          <div class="row admin-only" id="adminStatsSection" style="display: none;">
            <div class="col-lg-4 col-6">
              <div class="info-box">
                <span class="info-box-icon bg-info"><i class="fas fa-users"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">전체 직원</span>
                  <span class="info-box-number" id="totalEmployees">
                    <div class="loading-spinner"></div>
                  </span>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-6">
              <div class="info-box">
                <span class="info-box-icon bg-success"><i class="fas fa-user-check"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">오늘 출근</span>
                  <span class="info-box-number" id="todayAttendance">
                    <div class="loading-spinner"></div>
                  </span>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-6">
              <div class="info-box">
                <span class="info-box-icon bg-warning"><i class="fas fa-user-clock"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">승인 대기</span>
                  <span class="info-box-number" id="pendingApprovals">
                    <div class="loading-spinner"></div>
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- 최근 활동 -->
          <div class="row">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">최근 업무</h3>
                  <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-minus"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body p-0">
                  <ul class="products-list product-list-in-card pl-2 pr-2" id="recentActivities">
                    <li class="item text-center p-3">
                      <div class="loading-spinner"></div>
                      <span class="ml-2">최근 업무를 불러오는 중...</span>
                    </li>
                  </ul>
                </div>
                <div class="card-footer text-center">
                  <a href="#" class="uppercase">모든 업무 보기</a>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">공지사항</h3>
                  <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-minus"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <div class="timeline timeline-inverse" id="announcements">
                    <div class="text-center p-3">
                      <div class="loading-spinner"></div>
                      <span class="ml-2">공지사항을 불러오는 중...</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>
    </div>

    <!-- 푸터 컨테이너 -->
    <div id="footer-container"></div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer"></div>

  <!-- JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/3.2.0/js/adminlte.min.js"></script>
  
  <!-- 템플릿 로더 -->
  <script src="../js/template-loader.js"></script>
  
  <!-- 기존 대시보드 기능 -->
  <script src="../js/dashboard.js"></script>

  <script>
    // 새로운 초기화 방식
    $(document).ready(async function() {
      try {
        // 1단계: 템플릿 시스템 초기화 (인증 + 템플릿 로드 + 메뉴 활성화)
        await window.templateLoader.initializePage('dashboard');
        
        // 2단계: 대시보드 특화 기능 초기화
        if (window.dashboard) {
          await window.dashboard.initializeDashboardFeatures();
        }
        
        console.log('대시보드 초기화 완료!');
        
      } catch (error) {
        console.error('대시보드 초기화 실패:', error);
      }
    });
  </script>
</body>
</html>